"""
智能清理系统说明文档
==================

## ✨ 为什么要使用智能清理，而不是手动清理？

### 🤔 问题背景
你提出了一个很好的问题："为什么要用户手动清理，难道不能自动合理清理？"

**确实可以！而且应该以自动清理为主。**

### 🎯 设计理念

#### ❌ 旧设计问题
- 完全依赖手动清理 
- 用户需要记住清理命令
- 不知道什么时候该清理
- 清理策略固定，不够智能

#### ✅ 新设计优势
- **自动监控**: 每2分钟检查一次系统资源
- **智能触发**: 根据内存使用率自动清理
- **多级策略**: 警告→清理→紧急清理
- **手动补充**: 保留手动清理作为高级功能

## 🚀 智能清理工作原理

### 1. 自动监控阈值
```
内存使用率:
• 65% - 🟠 开始警告，轻量级清理（垃圾回收）
• 75% - 🟡 自动清理（内存+缓存清理）
• 85% - 🔴 紧急清理（强制清理+向量数据库）
```

### 2. 清理策略类型

#### 🎯 平衡策略 (默认)
- 内存警告: 65%
- 自动清理: 75% 
- 紧急清理: 85%
- 向量清理: 每4小时，每Agent最多300条记忆

#### ⚡ 性能优先策略
- 内存警告: 55%
- 自动清理: 65%
- 紧急清理: 75%
- 向量清理: 每1小时，每Agent最多150条记忆

#### 🐌 保守策略
- 内存警告: 80%
- 自动清理: 85%
- 紧急清理: 90%
- 向量清理: 每12小时，每Agent最多800条记忆

#### 🔥 激进策略
- 内存警告: 60%
- 自动清理: 70%
- 紧急清理: 80%
- 向量清理: 每2小时，每Agent最多200条记忆

### 3. 自动清理行为

#### 🟢 正常状态 (< 65%)
- 无动作，系统正常运行

#### 🟠 警告状态 (65-75%)
- 执行轻量级垃圾回收
- 清理过期缓存

#### 🟡 清理状态 (75-85%) 
- 自动执行系统内存清理
- 限制清理频率（30分钟一次）
- 显示清理信息

#### 🔴 紧急状态 (>85%)
- 强制垃圾回收
- 紧急内存清理
- 清理向量数据库低重要性记忆
- 限制紧急清理频率（10分钟一次）

## 🎮 用户体验改进

### 之前的体验：
```bash
# 用户需要记住命令和时机
🏘️ 小镇> cleanup normal    # 什么时候清理？
🏘️ 小镇> cleanup vector    # 清理什么类型？
🏘️ 小镇> cleanup emergency # 紧急情况？
```

### 现在的体验：
```bash
# 系统自动处理，用户专注核心功能
🏘️ 小镇> map              # 查看地图
🏘️ 小镇> social           # 查看社交网络
🏘️ 小镇> auto             # 开启自动模拟

# 系统后台自动提示：
🤖 内存使用率较高(76%)，执行自动清理
✅ 自动清理完成: 释放内存 45.2 MB
```

### 高级用户选项：
```bash
# 查看智能清理状态
🏘️ 小镇> memory           # 显示内存状态（含智能清理）
🏘️ 小镇> strategy         # 显示当前清理策略

# 调整清理策略
🏘️ 小镇> strategy performance  # 切换到性能优先
🏘️ 小镇> strategy conservative # 切换到保守策略

# 手动清理（高级功能）
🏘️ 小镇> cleanup smart    # 使用智能清理策略
🏘️ 小镇> cleanup emergency # 强制紧急清理
```

## 🔧 技术实现

### 核心组件：
1. **SmartCleanupManager**: 智能清理管理器
2. **CleanupThresholds**: 可配置的清理阈值
3. **后台监控线程**: 每2分钟检查系统资源
4. **多级清理策略**: 根据内存使用率触发不同级别清理

### 与现有系统的关系：
```
传统清理器 (memory_cleaner)
    ↓ 提供基础清理能力
智能清理管理器 (smart_cleanup_manager) 
    ↓ 智能决策何时清理
用户手动清理命令
    ↓ 高级用户的补充工具
```

## 📊 效果对比

### 🤖 自动清理的优势：
- ✅ 用户无需关心清理时机
- ✅ 根据实际资源使用智能决策
- ✅ 防止内存溢出和系统卡顿
- ✅ 清理策略可调节
- ✅ 最小化对用户体验的影响

### 🔧 手动清理的价值：
- ✅ 高级用户的精确控制
- ✅ 特殊情况的强制清理
- ✅ 性能调试和测试
- ✅ 系统维护工具

## 🎯 总结

**智能清理系统实现了"自动合理清理"的目标：**

1. **主要工作由系统自动完成** - 无需用户干预
2. **智能阈值管理** - 根据实际使用情况清理
3. **多级清理策略** - 从轻量级到强制清理
4. **可配置策略** - 适应不同用户需求
5. **手动清理作为补充** - 为高级用户提供精确控制

这样既解决了"为什么要手动清理"的问题，又保留了灵活性。
用户可以专注于与AI Agent的交互，系统会自动维护最佳性能状态。
"""
