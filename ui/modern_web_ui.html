<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèòÔ∏è AIËôöÊãüÂ∞èÈïá - Êô∫ËÉΩ‰∫§‰∫íÁâà</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-card: #16213e;
            --text-primary: #ffffff;
            --text-secondary: #a0a9c0;
            --border: #2d3748;
            --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        [data-theme="light"] {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --border: #e2e8f0;
            --glass: rgba(0, 0, 0, 0.05);
            --glass-border: rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Âä®ÊÄÅËÉåÊôØ */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(-45deg, #6366f1, #8b5cf6, #06b6d4, #10b981);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Á≤íÂ≠êÊïàÊûú */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }

        /* ÁéªÁíÉÂΩ¢ÊÄÅÂÆπÂô® */
        .glass-container {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            box-shadow: var(--shadow);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* È°∂ÈÉ®ÂØºËà™ */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            margin-bottom: 30px;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-toggle {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-primary);
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .status-bar {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        /* ‰∏ªË¶ÅÂÜÖÂÆπÂå∫ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            min-height: 800px;
        }

        .content-area {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        /* 3DÂú∞ÂõæÂå∫Âüü */
        .map-section {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 30px;
            position: relative;
            overflow: hidden;
        }

        .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .map-title {
            font-size: 1.8rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .map-controls {
            display: flex;
            gap: 10px;
        }

        .map-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 8px 16px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .map-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
        }

        /* 3DÂú∞ÂõæÁΩëÊ†º */
        .map-container {
            perspective: 1000px;
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .map-grid {
            display: grid;
            grid-template-columns: repeat(6, 80px);
            grid-template-rows: repeat(6, 80px);
            gap: 8px;
            transform: rotateX(15deg) rotateY(5deg);
            transition: transform 0.3s ease;
        }

        .map-grid:hover {
            transform: rotateX(10deg) rotateY(0deg);
        }

        .map-cell {
            background: linear-gradient(145deg, var(--bg-card), var(--bg-secondary));
            border: 2px solid var(--border);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .map-cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .map-cell:hover::before {
            opacity: 1;
        }

        .map-cell:hover {
            transform: translateZ(20px) rotateX(-5deg);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .map-cell.building {
            background: linear-gradient(145deg, var(--primary), var(--secondary));
            color: white;
            border-color: var(--primary);
        }

        .map-cell.agent {
            background: linear-gradient(145deg, var(--success), var(--accent));
            color: white;
            border-color: var(--success);
            animation: agentPulse 3s infinite;
        }

        @keyframes agentPulse {
            0%, 100% { box-shadow: 0 0 20px var(--success); }
            50% { box-shadow: 0 0 40px var(--success), 0 0 60px var(--success); }
        }

        /* Âè≥‰æßÈù¢Êùø */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 25px;
            transition: transform 0.3s ease;
        }

        .panel:hover {
            transform: translateY(-5px);
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .panel-title {
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* AgentÂç°Áâá */
        .agents-grid {
            display: grid;
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .agents-grid::-webkit-scrollbar {
            width: 6px;
        }

        .agents-grid::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 3px;
        }

        .agents-grid::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }

        .agent-card {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-secondary));
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .agent-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .agent-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            border-color: var(--primary);
        }

        .agent-card.selected {
            border-color: var(--primary);
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.3);
        }

        .agent-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .agent-avatar {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .agent-info h4 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .agent-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .agent-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 15px;
        }

        .stat-item {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 0.85rem;
            text-align: center;
        }

        .energy-bar {
            width: 100%;
            height: 6px;
            background: var(--bg-primary);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
        }

        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--warning));
            border-radius: 3px;
            transition: width 1s ease;
        }

        /* ËÅäÂ§©Âå∫Âüü */
        .chat-container {
            background: var(--bg-card);
            border-radius: 16px;
            height: 400px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: var(--bg-primary);
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }

        .message {
            display: flex;
            gap: 12px;
            animation: messageSlide 0.3s ease;
            align-items: flex-start;
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .message-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 12px 16px;
            max-width: 70%;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-color: var(--primary);
        }

        .chat-input {
            display: flex;
            padding: 15px 20px;
            gap: 10px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
        }

        .chat-input input {
            flex: 1;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 0.9rem;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .chat-input input:focus {
            border-color: var(--primary);
        }

        .chat-input button {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .chat-input button:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .sidebar {
                flex-direction: row;
                overflow-x: auto;
            }
            
            .panel {
                min-width: 300px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .navbar {
                padding: 15px 20px;
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .map-grid {
                grid-template-columns: repeat(6, 60px);
                grid-template-rows: repeat(6, 60px);
                gap: 4px;
            }
            
            .map-cell {
                font-size: 1.4rem;
            }
            
            .sidebar {
                flex-direction: column;
            }
        }

        /* Âä†ËΩΩÂä®Áîª */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Â∑•ÂÖ∑ÊèêÁ§∫ */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-card);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            border: 1px solid var(--border);
        }

        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }

        /* Âø´ÈÄüÊìç‰ΩúÊåâÈíÆ */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .quick-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .quick-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* ÈÄöÁü•Á≥ªÁªü */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 15px 20px;
            color: var(--text-primary);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid var(--success);
        }

        .notification.error {
            border-left: 4px solid var(--error);
        }

        .notification.warning {
            border-left: 4px solid var(--warning);
        }

        /* Agent‰∫§‰∫íÈù¢ÊùøÊ†∑Âºè */
        .interaction-feed {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .interaction-feed::-webkit-scrollbar {
            width: 6px;
        }

        .interaction-feed::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 3px;
        }

        .interaction-feed::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }

        .interaction-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .interaction-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .interaction-content {
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .interaction-participants {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }

        .participant-tag {
            background: var(--primary);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .social-network-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .social-network-modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            width: 90%;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-close {
            background: var(--error);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            font-weight: 500;
        }

        .relationship-grid {
            display: grid;
            gap: 15px;
        }

        .relationship-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 15px;
        }

        .relationship-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .relationship-strength {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
        }

        .strength-bar {
            width: 60px;
            height: 4px;
            background: var(--bg-primary);
            border-radius: 2px;
            overflow: hidden;
        }

        .strength-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--error), var(--warning), var(--success));
            border-radius: 2px;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body data-theme="dark">
    <!-- Âä®ÊÄÅËÉåÊôØ -->
    <div class="bg-animation"></div>
    <div class="particles" id="particles"></div>

    <div class="container">
        <!-- ÂØºËà™Ê†è -->
        <nav class="navbar">
            <div class="logo">
                <i class="fas fa-city"></i>
                <span>AIËôöÊãüÂ∞èÈïá</span>
                <span style="font-size: 0.8rem; opacity: 0.7;">v3.0</span>
            </div>
            
            <div class="nav-controls">
                <div class="status-bar">
                    <div class="status-item">
                        <div class="status-dot"></div>
                        <span>AIÁ≥ªÁªüÂú®Á∫ø</span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-users"></i>
                        <span id="agentCount">9‰∏™Agent</span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-building"></i>
                        <span>8‰∏™Âª∫Á≠ë</span>
                    </div>
                </div>
                
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon"></i>
                </button>
            </div>
        </nav>

        <!-- ‰∏ªË¶ÅÂÜÖÂÆπ -->
        <div class="main-content">
            <div class="content-area">
                <!-- 3DÂú∞ÂõæÂå∫Âüü -->
                <section class="map-section">
                    <div class="map-header">
                        <h2 class="map-title">
                            <i class="fas fa-map"></i>
                            Êô∫ËÉΩÂ∞èÈïá3DÂú∞Âõæ
                        </h2>
                        <div class="map-controls">
                            <button class="map-btn" onclick="refreshMap()">
                                <i class="fas fa-sync-alt"></i>
                                Âà∑Êñ∞
                            </button>
                            <button class="map-btn" onclick="simulateStep()">
                                <i class="fas fa-play"></i>
                                Ê®°Êãü
                            </button>
                            <button class="map-btn" onclick="triggerAgentInteraction()">
                                <i class="fas fa-users"></i>
                                ‰∫íÂä®
                            </button>
                            <button class="map-btn" onclick="showSocialNetwork()">
                                <i class="fas fa-network-wired"></i>
                                Á§æ‰∫§ÁΩëÁªú
                            </button>
                            <button class="map-btn" onclick="showAdvancedStats()">
                                <i class="fas fa-chart-line"></i>
                                È´òÁ∫ßÁªüËÆ°
                            </button>
                            <button class="map-btn" onclick="intelligentGroupMovement(); generateMap(); generateAgentCards();">
                                <i class="fas fa-route"></i>
                                Êô∫ËÉΩÁßªÂä®
                            </button>
                        </div>
                    </div>
                    
                    <div class="map-container">
                        <div class="map-grid" id="mapGrid">
                            <!-- Âú∞ÂõæÊ†ºÂ≠êÂ∞ÜÁî±JavaScriptÁîüÊàê -->
                        </div>
                    </div>
                    
                    <div id="simulationOutput" style="margin-top: 20px; padding: 15px; background: var(--bg-card); border-radius: 12px; border: 1px solid var(--border); font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; min-height: 80px; color: var(--text-secondary);"></div>
                </section>
            </div>

            <!-- Âè≥‰æßÈù¢Êùø -->
            <aside class="sidebar">
                <!-- AgentÊéßÂà∂Èù¢Êùø -->
                <div class="panel">
                    <div class="panel-header">
                        <h3 class="panel-title">
                            <i class="fas fa-robot"></i>
                            Êô∫ËÉΩAgent
                        </h3>
                        <span class="tooltip" data-tooltip="ÁÇπÂáªAgentÂç°ÁâáÈÄâÊã©ÂØπËØùÂØπË±°">
                            <i class="fas fa-info-circle"></i>
                        </span>
                    </div>
                    
                    <div class="agents-grid" id="agentsGrid">
                        <!-- AgentÂç°ÁâáÂ∞ÜÁî±JavaScriptÁîüÊàê -->
                    </div>
                    
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="randomizeAgents()">
                            <i class="fas fa-random"></i>
                            ÈöèÊú∫ÁßªÂä®
                        </button>
                        <button class="quick-btn" onclick="resetAgents()">
                            <i class="fas fa-home"></i>
                            ÂõûÂà∞ÂàùÂßã‰ΩçÁΩÆ
                        </button>
                        <button class="quick-btn" onclick="toggleAutoInteraction()">
                            <i class="fas fa-robot"></i>
                            <span id="autoInteractionText">Ëá™Âä®‰∫§‰∫í</span>
                        </button>
                        <button class="quick-btn" onclick="exportGameData()">
                            <i class="fas fa-download"></i>
                            ÂØºÂá∫Êï∞ÊçÆ
                        </button>
                        <button class="quick-btn" onclick="resetGameData()">
                            <i class="fas fa-trash"></i>
                            ÈáçÁΩÆÊï∞ÊçÆ
                        </button>
                        <button class="quick-btn" onclick="showDecayInfo()">
                            <i class="fas fa-heart"></i>
                            Ë°∞Âáè‰ø°ÊÅØ
                        </button>
                    </div>
                </div>

                <!-- AgentÈó¥‰∫§‰∫íÈù¢Êùø -->
                <div class="panel">
                    <div class="panel-header">
                        <h3 class="panel-title">
                            <i class="fas fa-comments"></i>
                            Agent‰∫§‰∫íËÆ∞ÂΩï
                        </h3>
                        <button class="quick-btn" onclick="clearInteractionHistory()">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    
                    <div class="interaction-feed" id="interactionFeed">
                        <div style="text-align: center; color: var(--text-secondary); padding: 20px;">
                            <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 10px; opacity: 0.3;"></i>
                            <p>Á≠âÂæÖAgentÈó¥ÁöÑ‰∫§‰∫í...</p>
                        </div>
                    </div>
                    
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="organizeGroupActivity()">
                            <i class="fas fa-calendar"></i>
                            ÁªÑÁªáÊ¥ªÂä®
                        </button>
                        <button class="quick-btn" onclick="showLocationStats()">
                            <i class="fas fa-chart-bar"></i>
                            Âú∞ÁÇπÁªüËÆ°
                        </button>
                    </div>
                </div>

                <!-- ËÅäÂ§©Èù¢Êùø -->
                <div class="panel">
                    <div class="panel-header">
                        <h3 class="panel-title">
                            <i class="fas fa-comments"></i>
                            Êô∫ËÉΩÂØπËØù
                        </h3>
                        <button class="quick-btn" onclick="clearChat()">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    
                    <div class="chat-container">
                        <div class="chat-header">
                            <i class="fas fa-robot"></i>
                            <span id="chatTitle">ÈÄâÊã©AgentÂºÄÂßãÂØπËØù</span>
                        </div>
                        
                        <div class="chat-messages" id="chatMessages">
                            <div style="text-align: center; color: var(--text-secondary); margin: auto;">
                                <i class="fas fa-comments" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
                                <p>ÁÇπÂáª‰∏äÊñπAgentÂç°ÁâáÂºÄÂßãÂØπËØù</p>
                                <p style="font-size: 0.8rem; margin-top: 10px;">AIÂ∞ÜÊ†πÊçÆAgentÁöÑÊÄßÊ†ºÁâπÁÇπËøõË°åÂõûÂ∫î</p>
                            </div>
                        </div>
                        
                        <div class="chat-input">
                            <input type="text" id="messageInput" placeholder="ËæìÂÖ•Ê∂àÊÅØ..." disabled>
                            <button onclick="sendMessage()" disabled id="sendBtn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="quickMessage('‰Ω†Â•ΩÔºÅ')">üëã ÊâìÊãõÂëº</button>
                        <button class="quick-btn" onclick="quickMessage('ÊúÄËøëÊÄé‰πàÊ†∑Ôºü')">‚ùì ËØ¢ÈóÆËøëÂÜµ</button>
                        <button class="quick-btn" onclick="quickMessage('ËÅäËÅäÂ∑•‰Ωú')">üíº Ë∞àËÆ∫Â∑•‰Ωú</button>
                        <button class="quick-btn" onclick="quickMessage('‰ªäÂ§©ËÆ°Âàí')">üìÖ ËØ¢ÈóÆËÆ°Âàí</button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- ÈÄöÁü•ÂÆπÂô® -->
    <div id="notification" class="notification"></div>

    <!-- Á§æ‰∫§ÁΩëÁªúÊ®°ÊÄÅÊ°Ü -->
    <div id="socialNetworkModal" class="social-network-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-network-wired"></i>
                    Á§æ‰∫§ÁΩëÁªúÂàÜÊûê
                </h2>
                <button class="modal-close" onclick="closeSocialNetwork()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="socialNetworkContent">
                <!-- Á§æ‰∫§ÁΩëÁªúÂÜÖÂÆπÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
            </div>
        </div>
    </div>

    <script>
        // Ê∏∏ÊàèÊï∞ÊçÆ - Â¢ûÂº∫ÁâàÊú¨ÔºåÊîØÊåÅagentÈó¥‰∫§‰∫í
        const gameData = {
            buildings: [
                {name: 'ÂíñÂï°ÂéÖ', emoji: '‚òï', x: 1, y: 3, description: 'Ê∏©È¶®ÁöÑÂíñÂï°ÂéÖ'},
                {name: 'Âõæ‰π¶È¶Ü', emoji: 'üìö', x: 4, y: 3, description: 'ÂÆâÈùôÁöÑÈòÖËØªÁ©∫Èó¥'},
                {name: 'ÂÖ¨Âõ≠', emoji: 'üå≥', x: 2, y: 1, description: 'ÁªøËâ≤ÁöÑ‰ºëÈó≤Âå∫'},
                {name: 'ÂäûÂÖ¨ÂÆ§', emoji: 'üíº', x: 5, y: 1, description: 'È´òÊïàÁöÑÂ∑•‰ΩúÂú∫ÊâÄ'},
                {name: 'ÂÆ∂', emoji: 'üè†', x: 3, y: 5, description: 'Ê∏©ÊöñÁöÑÂÆ∂'},
                {name: 'ÂåªÈô¢', emoji: 'üè•', x: 0, y: 2, description: 'ÂåªÁñó‰∏≠ÂøÉ'},
                {name: 'È§êÂéÖ', emoji: 'üçΩÔ∏è', x: 5, y: 4, description: 'ÁæéÈ£üÂ§©Âú∞'},
                {name: '‰øÆÁêÜÂ∫ó', emoji: 'üîß', x: 1, y: 0, description: 'Áª¥‰øÆÂ∑•Âùä'}
            ],
            agents: {
                'Alex': {
                    emoji: 'üë®‚Äçüíª', 
                    occupation: 'Á®ãÂ∫èÂëò', 
                    location: 'ÂäûÂÖ¨ÂÆ§', 
                    x: 5, y: 1, 
                    energy: 85, 
                    mood: '‰∏ìÊ≥®', 
                    personality: 'ÈÄªËæëÊÄùÁª¥Âº∫ÔºåÂñúÊ¨¢Ëß£ÂÜ≥ÊäÄÊúØÈóÆÈ¢ò',
                    background: 'ËÆ°ÁÆóÊú∫ÁßëÂ≠¶‰∏ì‰∏öÔºåÁÉ≠Áà±ÁºñÁ®ãÂíåÁÆóÊ≥ï',
                    expertise: ['ÁºñÁ®ã', 'ÁÆóÊ≥ï', 'ÊäÄÊúØÂ≠¶‰π†', 'ÈóÆÈ¢òËß£ÂÜ≥'],
                    preferences: ['ÂíñÂï°ÂéÖ', 'ÂäûÂÖ¨ÂÆ§', 'Âõæ‰π¶È¶Ü'],
                    relationships: {}, 
                    lastInteraction: null,
                    memories: [],
                    currentThoughts: ''
                },
                'Emma': {
                    emoji: 'üë©‚Äçüé®', 
                    occupation: 'Ëâ∫ÊúØÂÆ∂', 
                    location: 'ÂÖ¨Âõ≠', 
                    x: 2, y: 1, 
                    energy: 90, 
                    mood: 'Âàõ‰Ωú‰∏≠', 
                    personality: 'ÂØåÊúâÂàõÈÄ†ÂäõÔºåÊÑüÊÄß‰∏∞ÂØå',
                    background: 'Ëâ∫ÊúØÂ≠¶Èô¢ÊØï‰∏öÔºåÊìÖÈïøÁªòÁîªÂíåËÆæËÆ°',
                    expertise: ['Ëâ∫ÊúØÂàõ‰Ωú', 'Ëâ≤ÂΩ©ËÆæËÆ°', 'ÁæéÂ≠¶ÊÑüÁü•', 'ÂàõÊÑèË°®Ëææ'],
                    preferences: ['ÂÖ¨Âõ≠', 'ÂÆ∂', 'ÂíñÂï°ÂéÖ'],
                    relationships: {}, 
                    lastInteraction: null,
                    memories: [],
                    currentThoughts: ''
                },
                'Sarah': {
                    emoji: 'üë©‚Äçüè´', 
                    occupation: 'ÊïôÂ∏à', 
                    location: 'Âõæ‰π¶È¶Ü', 
                    x: 4, y: 3, 
                    energy: 75, 
                    mood: 'ÂºÄÂøÉ', 
                    personality: 'ËÄêÂøÉÂèãÂñÑÔºåÂñÑ‰∫éÊ≤üÈÄö',
                    background: 'ÊïôËÇ≤Â≠¶‰∏ì‰∏öÔºåÊúâÂ§öÂπ¥ÊïôÂ≠¶ÁªèÈ™å',
                    expertise: ['ÊïôËÇ≤', 'Áü•ËØÜÂàÜ‰∫´', 'Â≠¶‰π†ÊåáÂØº', 'Ê≤üÈÄöÊäÄÂ∑ß'],
                    preferences: ['Âõæ‰π¶È¶Ü', 'ÂíñÂï°ÂéÖ', 'ÂÖ¨Âõ≠'],
                    relationships: {}, 
                    lastInteraction: null,
                    memories: [],
                    currentThoughts: ''
                },
                'David': {
                    emoji: 'üë®‚Äçüíº', 
                    occupation: 'ÂïÜ‰∫∫', 
                    location: 'ÂäûÂÖ¨ÂÆ§', 
                    x: 5, y: 1, 
                    energy: 80, 
                    mood: 'ÂøôÁ¢å', 
                    personality: 'Á≤æÊòéËÉΩÂπ≤ÔºåÂñÑ‰∫é‰∫§ÈôÖ',
                    background: 'ÂïÜÂ≠¶Èô¢ÊØï‰∏öÔºåÊúâ‰∏∞ÂØåÁöÑÂïÜ‰∏öÁªèÈ™å',
                    expertise: ['ÂïÜ‰∏öÁ≠ñÁï•', 'ÊäïËµÑÂàÜÊûê', 'Â∏ÇÂú∫Ê¥ûÂØü', '‰∫∫ÈôÖ‰∫§ÂæÄ'],
                    preferences: ['ÂäûÂÖ¨ÂÆ§', 'ÂíñÂï°ÂéÖ', 'È§êÂéÖ'],
                    relationships: {}, 
                    lastInteraction: null,
                    memories: [],
                    currentThoughts: ''
                },
                'Lisa': {
                    emoji: 'üë©‚Äçüéì', 
                    occupation: 'Â≠¶Áîü', 
                    location: 'Âõæ‰π¶È¶Ü', 
                    x: 4, y: 3, 
                    energy: 95, 
                    mood: 'ÂÖ¥Â•ã', 
                    personality: 'Â•ΩÂ≠¶‰∏äËøõÔºåÂÖÖÊª°Ê¥ªÂäõ',
                    background: 'Â§ßÂ≠¶ÁîüÔºåÊ≠£Âú®Â≠¶‰π†ËÆ°ÁÆóÊú∫ÁßëÂ≠¶',
                    expertise: ['Â≠¶‰π†', 'ÊèêÈóÆ', 'Âê∏Êî∂Áü•ËØÜ', 'ÊäÄÊúØÊé¢Á¥¢'],
                    preferences: ['Âõæ‰π¶È¶Ü', 'ÂíñÂï°ÂéÖ', 'ÂÖ¨Âõ≠'],
                    relationships: {}, 
                    lastInteraction: null,
                    memories: [],
                    currentThoughts: ''
                },
                'Mike': {
                    emoji: 'üë¥', 
                    occupation: 'ÈÄÄ‰ºë‰∫∫Âëò', 
                    location: 'ÂÖ¨Âõ≠', 
                    x: 2, y: 1, 
                    energy: 60, 
                    mood: 'Âπ≥Èùô', 
                    personality: 'ÊÇ†Èó≤Ëá™Âú®ÔºåÁªèÈ™å‰∏∞ÂØå',
                    background: 'ÈÄÄ‰ºëÂ∑•Á®ãÂ∏àÔºåÊúâ‰∏∞ÂØåÁöÑ‰∫∫ÁîüÁªèÈ™å',
                    expertise: ['‰∫∫ÁîüÁªèÈ™å', 'ÊïÖ‰∫ãÂàÜ‰∫´', 'ÁîüÊ¥ªÊô∫ÊÖß', '‰ºëÈó≤Â®±‰πê'],
                    preferences: ['ÂÖ¨Âõ≠', 'ÂÆ∂', 'ÂíñÂï°ÂéÖ'],
                    relationships: {}, 
                    lastInteraction: null,
                    memories: [],
                    currentThoughts: ''
                },
                'John': {
                    emoji: 'üë®‚Äç‚öïÔ∏è', 
                    occupation: 'ÂåªÁîü', 
                    location: 'ÂåªÈô¢', 
                    x: 0, y: 2, 
                    energy: 70, 
                    mood: '‰∏ì‰∏ö', 
                    personality: 'ÁªÜÂøÉË¥üË¥£ÔºåÂÖ≥Áà±ÁóÖ‰∫∫',
                    background: 'ÂåªÂ≠¶Èô¢ÊØï‰∏öÔºåÊúâÂ§öÂπ¥‰∏¥Â∫äÁªèÈ™å',
                    expertise: ['ÂåªÁñóËØäÊñ≠', 'ÂÅ•Â∫∑Âí®ËØ¢', 'ÁóÖ‰∫∫ÂÖ≥ÊÄÄ', 'ÂåªÂ≠¶Áü•ËØÜ'],
                    preferences: ['ÂåªÈô¢', 'Âõæ‰π¶È¶Ü', 'ÂíñÂï°ÂéÖ'],
                    relationships: {}, 
                    lastInteraction: null,
                    memories: [],
                    currentThoughts: ''
                },
                'Anna': {
                    emoji: 'üë©‚Äçüç≥', 
                    occupation: 'Âé®Â∏à', 
                    location: 'È§êÂéÖ', 
                    x: 5, y: 4, 
                    energy: 85, 
                    mood: 'ÊÑâÂø´', 
                    personality: 'ÁÉ≠ÊÉÖÂ•ΩÂÆ¢ÔºåÊâãËâ∫Á≤æÊπõ',
                    background: 'ÁÉπÈ•™Â≠¶Ê†°ÊØï‰∏öÔºåÊúâÂ§öÂπ¥ÁÉπÈ•™ÁªèÈ™å',
                    expertise: ['ÁÉπÈ•™ÊäÄÂ∑ß', 'ÁæéÈ£üÂà∂‰Ωú', 'È£üÊùêÊê≠ÈÖç', 'È§êÈ•ÆÊúçÂä°'],
                    preferences: ['È§êÂéÖ', 'ÂÆ∂', 'ÂíñÂï°ÂéÖ'],
                    relationships: {}, 
                    lastInteraction: null,
                    memories: [],
                    currentThoughts: ''
                },
                'Tom': {
                    emoji: 'üë®‚Äçüîß', 
                    occupation: 'Êú∫Ê¢∞Â∏à', 
                    location: '‰øÆÁêÜÂ∫ó', 
                    x: 1, y: 0, 
                    energy: 75, 
                    mood: '‰∏ìÊ≥®', 
                    personality: 'Âä®ÊâãËÉΩÂäõÂº∫ÔºåÂÆûÁî®‰∏ª‰πâ',
                    background: 'ÊäÄÂ∑•Â≠¶Ê†°ÊØï‰∏öÔºåÊúâÂ§öÂπ¥Áª¥‰øÆÁªèÈ™å',
                    expertise: ['Êú∫Ê¢∞Áª¥‰øÆ', 'Â∑•ÂÖ∑‰ΩøÁî®', 'ÈóÆÈ¢òËØäÊñ≠', 'ÂÆûÁî®ÊäÄËÉΩ'],
                    preferences: ['‰øÆÁêÜÂ∫ó', 'ÂÆ∂', 'ÂíñÂï°ÂéÖ'],
                    relationships: {}, 
                    lastInteraction: null,
                    memories: [],
                    currentThoughts: ''
                }
            },
            chatHistory: [],
            selectedAgent: null,
            agentInteractions: [], // ËÆ∞ÂΩïagentÈó¥ÁöÑ‰∫§‰∫í
            socialNetwork: {}, // Á§æ‰∫§ÁΩëÁªú
            locationPopularity: {}, // Âú∞ÁÇπÁÉ≠Â∫¶
            autoInteraction: true, // Ëá™Âä®‰∫§‰∫íÂºÄÂÖ≥
            systemTime: new Date(), // Á≥ªÁªüÊó∂Èó¥
            lastDecayTime: new Date(), // ‰∏äÊ¨°ÂÖ≥Á≥ªË°∞ÂáèÊó∂Èó¥
            decayInterval: 30 * 60 * 1000 // 30ÂàÜÈíüË°∞ÂáèÈó¥Èöî
        };

        let animationId;

        // ÂàùÂßãÂåñÁ§æ‰∫§ÁΩëÁªúÂíåÂÖ≥Á≥ª
        function initializeSocialNetwork() {
            const agentNames = Object.keys(gameData.agents);
            
            // ÂàùÂßãÂåñÊØè‰∏™agentÁöÑÂÖ≥Á≥ªÁΩëÁªú
            agentNames.forEach(agentA => {
                gameData.agents[agentA].relationships = {};
                agentNames.forEach(agentB => {
                    if (agentA !== agentB) {
                        // Âü∫‰∫éËÅå‰∏öÂíåÊÄßÊ†ºÁîüÊàêÂàùÂßãÂÖ≥Á≥ªÂº∫Â∫¶
                        const strength = generateInitialRelationship(agentA, agentB);
                        gameData.agents[agentA].relationships[agentB] = {
                            strength: strength,
                            interactions: 0,
                            lastMet: null,
                            topics: [],
                            interactionHistory: [],
                            relationshipLevel: getRelationshipLevel(strength)
                        };
                    }
                });
            });
            
            // ÂàùÂßãÂåñÂú∞ÁÇπÁÉ≠Â∫¶
            gameData.buildings.forEach(building => {
                gameData.locationPopularity[building.name] = {
                    visits: 0,
                    currentOccupants: 0,
                    popularityScore: 50,
                    interactions: 0,
                    lastActivity: new Date()
                };
            });
        }

        // ÁîüÊàêÂàùÂßãÂÖ≥Á≥ªÂº∫Â∫¶
        function generateInitialRelationship(agentA, agentB) {
            const agentAData = gameData.agents[agentA];
            const agentBData = gameData.agents[agentB];
            
            // Âü∫‰∫éËÅå‰∏öÁõ∏ÊÄß
            const occupationCompatibility = {
                'Á®ãÂ∫èÂëò': {'Ëâ∫ÊúØÂÆ∂': 0.6, 'ÊïôÂ∏à': 0.7, 'ÂïÜ‰∫∫': 0.8, 'Â≠¶Áîü': 0.9, 'ÈÄÄ‰ºë‰∫∫Âëò': 0.5, 'ÂåªÁîü': 0.7, 'Âé®Â∏à': 0.6, 'Êú∫Ê¢∞Â∏à': 0.8},
                'Ëâ∫ÊúØÂÆ∂': {'ÊïôÂ∏à': 0.8, 'ÂïÜ‰∫∫': 0.5, 'Â≠¶Áîü': 0.9, 'ÈÄÄ‰ºë‰∫∫Âëò': 0.7, 'ÂåªÁîü': 0.6, 'Âé®Â∏à': 0.8, 'Êú∫Ê¢∞Â∏à': 0.4},
                'ÊïôÂ∏à': {'ÂïÜ‰∫∫': 0.6, 'Â≠¶Áîü': 0.9, 'ÈÄÄ‰ºë‰∫∫Âëò': 0.8, 'ÂåªÁîü': 0.8, 'Âé®Â∏à': 0.7, 'Êú∫Ê¢∞Â∏à': 0.6},
                'ÂïÜ‰∫∫': {'Â≠¶Áîü': 0.7, 'ÈÄÄ‰ºë‰∫∫Âëò': 0.6, 'ÂåªÁîü': 0.7, 'Âé®Â∏à': 0.8, 'Êú∫Ê¢∞Â∏à': 0.7},
                'Â≠¶Áîü': {'ÈÄÄ‰ºë‰∫∫Âëò': 0.8, 'ÂåªÁîü': 0.7, 'Âé®Â∏à': 0.6, 'Êú∫Ê¢∞Â∏à': 0.5},
                'ÈÄÄ‰ºë‰∫∫Âëò': {'ÂåªÁîü': 0.8, 'Âé®Â∏à': 0.9, 'Êú∫Ê¢∞Â∏à': 0.7},
                'ÂåªÁîü': {'Âé®Â∏à': 0.7, 'Êú∫Ê¢∞Â∏à': 0.6},
                'Âé®Â∏à': {'Êú∫Ê¢∞Â∏à': 0.8}
            };
            
            let compatibility = 0.5; // ÈªòËÆ§Áõ∏ÊÄß
            
            // Êü•ÊâæËÅå‰∏öÁõ∏ÊÄß
            if (occupationCompatibility[agentAData.occupation] && 
                occupationCompatibility[agentAData.occupation][agentBData.occupation]) {
                compatibility = occupationCompatibility[agentAData.occupation][agentBData.occupation];
            } else if (occupationCompatibility[agentBData.occupation] && 
                       occupationCompatibility[agentBData.occupation][agentAData.occupation]) {
                compatibility = occupationCompatibility[agentBData.occupation][agentAData.occupation];
            }
            
            // ‰ΩçÁΩÆÊïàÊûú
            let locationEffect = 1.0;
            if (agentAData.location === agentBData.location) {
                locationEffect = 1.2; // ÂêåÂú∞ÁÇπÂ¢ûÂä†20%ÂÖ≥Á≥ª
            }
            
            // ÊÄßÊ†ºÂåπÈÖçÂ∫¶
            let personalityMatch = 1.0;
            const personalityKeywords = {
                'ÈÄªËæëÊÄùÁª¥': ['ÊäÄÊúØ', 'ÁºñÁ®ã', 'ÁÆóÊ≥ï', 'ÈóÆÈ¢òËß£ÂÜ≥'],
                'ÂàõÈÄ†Âäõ': ['Ëâ∫ÊúØ', 'ËÆæËÆ°', 'ÂàõÊÑè', 'ÁæéÂ≠¶'],
                'ËÄêÂøÉ': ['ÊïôËÇ≤', 'ÊïôÂ≠¶', 'ÊåáÂØº', 'Ê≤üÈÄö'],
                'Á≤æÊòé': ['ÂïÜ‰∏ö', 'ÊäïËµÑ', 'Â∏ÇÂú∫', 'Á≠ñÁï•'],
                'Â•ΩÂ≠¶': ['Â≠¶‰π†', 'Êé¢Á¥¢', 'ÊèêÈóÆ', 'Âê∏Êî∂'],
                'ÁªèÈ™å': ['‰∫∫Áîü', 'ÊïÖ‰∫ã', 'Êô∫ÊÖß', '‰ºëÈó≤'],
                'ÁªÜÂøÉ': ['ÂåªÁñó', 'ËØäÊñ≠', 'ÂÖ≥ÊÄÄ', '‰∏ì‰∏ö'],
                'ÁÉ≠ÊÉÖ': ['ÁÉπÈ•™', 'ÁæéÈ£ü', 'ÊúçÂä°', 'ÊâãËâ∫'],
                'ÂÆûÁî®': ['Áª¥‰øÆ', 'Â∑•ÂÖ∑', 'ÊäÄËÉΩ', 'Âä®Êâã']
            };
            
            // ËÆ°ÁÆóÊÄßÊ†ºÂåπÈÖçÂ∫¶
            const agentAKeywords = agentAData.expertise.join(' ');
            const agentBKeywords = agentBData.expertise.join(' ');
            
            let commonKeywords = 0;
            Object.values(personalityKeywords).forEach(keywords => {
                keywords.forEach(keyword => {
                    if (agentAKeywords.includes(keyword) && agentBKeywords.includes(keyword)) {
                        commonKeywords++;
                    }
                });
            });
            
            if (commonKeywords > 0) {
                personalityMatch = 1.0 + (commonKeywords * 0.1);
            }
            
            // Ê∑ªÂä†ÈöèÊú∫Âõ†Á¥†
            const randomFactor = 0.8 + Math.random() * 0.4; // 0.8-1.2
            
            // ËÆ°ÁÆóÊúÄÁªàÂÖ≥Á≥ªÂº∫Â∫¶
            const finalStrength = compatibility * locationEffect * personalityMatch * randomFactor;
            
            return Math.min(1.0, Math.max(0.1, finalStrength));
        }

        // Ëé∑ÂèñÂÖ≥Á≥ªÁ≠âÁ∫ß
        function getRelationshipLevel(strength) {
            if (strength >= 0.8) return '‰∫≤ÂØÜÊúãÂèã';
            if (strength >= 0.6) return 'Â•ΩÊúãÂèã';
            if (strength >= 0.4) return 'ÊôÆÈÄöÊúãÂèã';
            if (strength >= 0.2) return 'ÁÜü‰∫∫';
            return 'ÈôåÁîü‰∫∫';
        }

        // ÂÖ≥Á≥ªË°∞ÂáèÁ≥ªÁªü
        function applyRelationshipDecay() {
            const now = new Date();
            const timeDiff = now - gameData.lastDecayTime;
            
            if (timeDiff >= gameData.decayInterval) {
                const agentNames = Object.keys(gameData.agents);
                
                agentNames.forEach(agentA => {
                    agentNames.forEach(agentB => {
                        if (agentA !== agentB) {
                            const relationship = gameData.agents[agentA].relationships[agentB];
                            if (relationship) {
                                // Âü∫Á°ÄË°∞Âáè
                                const baseDecay = 0.02;
                                
                                // Ê†πÊçÆÂÖ≥Á≥ªÂº∫Â∫¶Ë∞ÉÊï¥Ë°∞Âáè
                                let decayRate = baseDecay;
                                if (relationship.strength > 0.7) {
                                    decayRate *= 0.5; // ‰∫≤ÂØÜÊúãÂèãË°∞ÂáèËæÉÊÖ¢
                                } else if (relationship.strength < 0.3) {
                                    decayRate *= 1.5; // ÈôåÁîü‰∫∫Ë°∞ÂáèËæÉÂø´
                                }
                                
                                // ÈöèÊú∫Ë°∞Âáè
                                if (Math.random() < 0.15) { // 15%Ê¶ÇÁéáÈ¢ùÂ§ñË°∞Âáè
                                    const randomDecay = Math.random() * 0.01;
                                    decayRate += randomDecay;
                                }
                                
                                // Â∫îÁî®Ë°∞Âáè
                                relationship.strength = Math.max(0.1, relationship.strength - decayRate);
                                relationship.relationshipLevel = getRelationshipLevel(relationship.strength);
                            }
                        }
                    });
                });
                
                gameData.lastDecayTime = now;
                console.log('ÂÖ≥Á≥ªË°∞ÂáèÂ∑≤Â∫îÁî®');
            }
        }

        // ÂàùÂßãÂåñÁ≤íÂ≠êÊïàÊûú
        function initParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // ‰∏ªÈ¢òÂàáÊç¢
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('themeIcon');
            const currentTheme = body.getAttribute('data-theme');
            
            if (currentTheme === 'dark') {
                body.setAttribute('data-theme', 'light');
                themeIcon.className = 'fas fa-sun';
                showNotification('Â∑≤ÂàáÊç¢Âà∞ÊµÖËâ≤‰∏ªÈ¢ò', 'success');
            } else {
                body.setAttribute('data-theme', 'dark');
                themeIcon.className = 'fas fa-moon';
                showNotification('Â∑≤ÂàáÊç¢Âà∞Ê∑±Ëâ≤‰∏ªÈ¢ò', 'success');
            }
        }

        // ÈÄöÁü•Á≥ªÁªü
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ÁîüÊàê3DÂú∞Âõæ
        function generateMap() {
            const mapGrid = document.getElementById('mapGrid');
            mapGrid.innerHTML = '';
            
            for (let y = 0; y < 6; y++) {
                for (let x = 0; x < 6; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'map-cell';
                    cell.setAttribute('data-x', x);
                    cell.setAttribute('data-y', y);
                    
                    let cellContent = '‚¨ú';
                    let cellClass = 'map-cell';
                    let tooltip = `ÂùêÊ†á (${x}, ${y})`;
                    
                    // Ê£ÄÊü•Âª∫Á≠ë
                    const building = gameData.buildings.find(b => b.x === x && b.y === y);
                    if (building) {
                        cellContent = building.emoji;
                        cellClass += ' building';
                        tooltip = `${building.name} - ${building.description}`;
                    }
                    
                    // Ê£ÄÊü•AgentÔºà‰ºòÂÖàÊòæÁ§∫Ôºâ
                    const agentsHere = Object.entries(gameData.agents).filter(([name, agent]) => agent.x === x && agent.y === y);
                    if (agentsHere.length > 0) {
                        if (agentsHere.length === 1) {
                            cellContent = agentsHere[0][1].emoji;
                            tooltip = `${agentsHere[0][0]} (${agentsHere[0][1].occupation}) - ${agentsHere[0][1].mood}`;
                        } else {
                            cellContent = `üë•${agentsHere.length}`;
                            tooltip = `${agentsHere.map(([name]) => name).join(', ')}`;
                        }
                        cellClass += ' agent';
                    }
                    
                    cell.className = cellClass;
                    cell.textContent = cellContent;
                    cell.title = tooltip;
                    cell.onclick = () => showCellInfo(x, y);
                    
                    mapGrid.appendChild(cell);
                }
            }
        }

        // ÊòæÁ§∫Ê†ºÂ≠êËØ¶ÁªÜ‰ø°ÊÅØ
        function showCellInfo(x, y) {
            let info = `üìç ‰ΩçÁΩÆ (${x}, ${y})\n\n`;
            
            const building = gameData.buildings.find(b => b.x === x && b.y === y);
            if (building) {
                info += `üè¢ Âª∫Á≠ë: ${building.emoji} ${building.name}\nüìù ${building.description}\n\n`;
            }
            
            const agentsHere = Object.entries(gameData.agents).filter(([name, agent]) => agent.x === x && agent.y === y);
            if (agentsHere.length > 0) {
                info += `ü§ñ Agent:\n`;
                agentsHere.forEach(([name, agent]) => {
                    info += `‚Ä¢ ${agent.emoji} ${name} (${agent.occupation})\n  üí≠ ${agent.mood} | ‚ö° ${agent.energy}%\n  üß† ${agent.personality}\n\n`;
                });
            }
            
            if (!building && agentsHere.length === 0) {
                info += "üå± ËøôÈáåÊòØÁ©∫Âú∞ÔºåÁ≠âÂæÖÂºÄÂèë...";
            }
            
            showNotification(`Êü•Áúã‰ΩçÁΩÆ (${x}, ${y}) ËØ¶ÊÉÖ`, 'success');
            alert(info);
        }

        // ÁîüÊàêAgentÂç°Áâá
        function generateAgentCards() {
            const agentsGrid = document.getElementById('agentsGrid');
            agentsGrid.innerHTML = '';
            
            Object.entries(gameData.agents).forEach(([name, agent]) => {
                const energyColor = agent.energy > 70 ? 'var(--success)' : agent.energy > 40 ? 'var(--warning)' : 'var(--error)';
                
                // ËÆ°ÁÆóÂÖ≥Á≥ªÁªüËÆ°
                const relationships = agent.relationships || {};
                const totalRelationships = Object.keys(relationships).length;
                const strongRelationships = Object.values(relationships).filter(rel => rel.strength > 0.6).length;
                const avgRelationshipStrength = totalRelationships > 0 ? 
                    Object.values(relationships).reduce((sum, rel) => sum + rel.strength, 0) / totalRelationships : 0;
                
                const card = document.createElement('div');
                card.className = 'agent-card';
                card.onclick = () => selectAgent(name);
                
                card.innerHTML = `
                    <div class="agent-header">
                        <div class="agent-avatar">${agent.emoji}</div>
                        <div class="agent-info">
                            <h4>${name}</h4>
                            <p>${agent.occupation}</p>
                            <p style="font-size: 0.8rem; color: var(--text-secondary);">${agent.background}</p>
                        </div>
                    </div>
                    <div class="agent-stats">
                        <div class="stat-item">üìç ${agent.location}</div>
                        <div class="stat-item">üòä ${agent.mood}</div>
                        <div class="stat-item">
                            ‚ö° ${agent.energy}%
                            <div class="energy-bar">
                                <div class="energy-fill" style="width: ${agent.energy}%; background: ${energyColor};"></div>
                            </div>
                        </div>
                        <div class="stat-item">üéØ (${agent.x}, ${agent.y})</div>
                        <div class="stat-item">‚ù§Ô∏è ${strongRelationships}/${totalRelationships} Â•ΩÂèã</div>
                        <div class="stat-item">üß† ${agent.memories.length} ËÆ∞ÂøÜ</div>
                    </div>
                    <div style="margin-top: 10px; font-size: 0.8rem; color: var(--text-secondary);">
                        <strong>‰∏ìÈïø:</strong> ${agent.expertise.slice(0, 3).join(', ')}${agent.expertise.length > 3 ? '...' : ''}
                    </div>
                `;
                
                agentsGrid.appendChild(card);
            });
        }

        // ÈÄâÊã©Agent
        function selectAgent(agentName) {
            gameData.selectedAgent = agentName;
            const agent = gameData.agents[agentName];
            
            // Êõ¥Êñ∞UIÁä∂ÊÄÅ
            document.querySelectorAll('.agent-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Êõ¥Êñ∞ËÅäÂ§©Ê†áÈ¢ò
            document.getElementById('chatTitle').innerHTML = `
                ${agent.emoji} ${agentName} - ${agent.occupation}
            `;
            
            // ÂêØÁî®ËÅäÂ§©ËæìÂÖ•
            document.getElementById('messageInput').disabled = false;
            document.getElementById('sendBtn').disabled = false;
            document.getElementById('messageInput').placeholder = `‰∏é ${agentName} ÂØπËØù...`;
            
            showNotification(`Â∑≤ÈÄâÊã© ${agentName}ÔºåÂºÄÂßãÂØπËØùÂêßÔºÅ`, 'success');
        }

        // ÂèëÈÄÅÊ∂àÊÅØ
        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (!message || !gameData.selectedAgent) return;
            
            const agent = gameData.agents[gameData.selectedAgent];
            
            // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØ
            addMessage('user', 'üßë ‰Ω†', message);
            
            // Ê®°ÊãüAIÊÄùËÄÉ
            const sendBtn = document.getElementById('sendBtn');
            sendBtn.innerHTML = '<div class="loading"></div>';
            sendBtn.disabled = true;
            
            setTimeout(() => {
                const response = generateAgentResponse(gameData.selectedAgent, message);
                addMessage('agent', `${agent.emoji} ${gameData.selectedAgent}`, response);
                
                // Êõ¥Êñ∞AgentÁä∂ÊÄÅ
                updateAgentAfterChat(gameData.selectedAgent);
                
                sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i>';
                sendBtn.disabled = false;
            }, 1000 + Math.random() * 2000); // 1-3ÁßíÊÄùËÄÉÊó∂Èó¥
            
            messageInput.value = '';
        }

        // Ê∑ªÂä†Ê∂àÊÅØÂà∞ËÅäÂ§©
        function addMessage(type, sender, content) {
            const chatMessages = document.getElementById('chatMessages');
            
            // Ê∏ÖÁ©∫ÂàùÂßãÊèêÁ§∫
            if (chatMessages.children.length === 1 && chatMessages.children[0].style.textAlign === 'center') {
                chatMessages.innerHTML = '';
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${sender.split(' ')[0]}</div>
                <div class="message-content">
                    <div style="font-size: 0.8rem; opacity: 0.7; margin-bottom: 4px;">
                        ${sender} ‚Ä¢ ${timestamp}
                    </div>
                    ${content}
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // ‰øùÂ≠òÂà∞ÂéÜÂè≤ËÆ∞ÂΩï
            gameData.chatHistory.push({
                type, sender, content, timestamp
            });
        }

        // Ëß¶ÂèëagentÈó¥‰∫§‰∫í
        function triggerAgentInteraction() {
            const agentNames = Object.keys(gameData.agents);
            const interactingAgents = [];
            
            // ÊâæÂà∞Âú®Âêå‰∏Ä‰ΩçÁΩÆÁöÑagents
            const locationGroups = {};
            agentNames.forEach(name => {
                const agent = gameData.agents[name];
                const key = `${agent.x},${agent.y}`;
                if (!locationGroups[key]) {
                    locationGroups[key] = [];
                }
                locationGroups[key].push(name);
            });
            
            // Âú®ÊúâÂ§ö‰∏™agentÁöÑ‰ΩçÁΩÆËß¶Âèë‰∫§‰∫í
            Object.values(locationGroups).forEach(group => {
                if (group.length >= 2) {
                    // ÈöèÊú∫ÈÄâÊã©2‰∏™ÊàñÊõ¥Â§öagentsËøõË°å‰∫§‰∫í
                    const shuffled = group.sort(() => 0.5 - Math.random());
                    const participants = shuffled.slice(0, Math.min(3, shuffled.length));
                    
                    if (participants.length >= 2) {
                        executeAgentInteraction(participants);
                    }
                }
            });
            
            // Â¶ÇÊûúÊ≤°ÊúâËá™ÁÑ∂‰∫§‰∫íÔºåÈöèÊú∫ÂàõÂª∫‰∏Ä‰∏™
            if (interactingAgents.length === 0) {
                const randomAgents = agentNames.sort(() => 0.5 - Math.random()).slice(0, 2);
                executeAgentInteraction(randomAgents);
            }
        }

        // ÊâßË°åagent‰∫§‰∫í
        function executeAgentInteraction(participants) {
            const location = gameData.agents[participants[0]].location;
            const interactionType = getInteractionType(participants, location);
            const conversation = generateGroupConversation(participants, interactionType, location);
            
            // ËÆ∞ÂΩï‰∫§‰∫í
            const interaction = {
                id: Date.now(),
                timestamp: new Date().toLocaleTimeString(),
                participants: participants,
                location: location,
                type: interactionType,
                conversation: conversation
            };
            
            gameData.agentInteractions.unshift(interaction);
            
            // Êõ¥Êñ∞ÂÖ≥Á≥ªÂº∫Â∫¶
            let totalRelationshipChange = 0;
            participants.forEach(agentA => {
                participants.forEach(agentB => {
                    if (agentA !== agentB) {
                        const change = updateRelationship(agentA, agentB, interactionType, participants, location);
                        totalRelationshipChange += change;
                    }
                });
            });
            
            // Êõ¥Êñ∞Âú∞ÁÇπÁÉ≠Â∫¶
            if (gameData.locationPopularity[location]) {
                gameData.locationPopularity[location].interactions = 
                    (gameData.locationPopularity[location].interactions || 0) + 1;
                gameData.locationPopularity[location].popularityScore += 0.1;
                gameData.locationPopularity[location].lastActivity = new Date();
            }
            
            // ÊòæÁ§∫‰∫§‰∫í
            displayInteraction(interaction);
            
            // ÊòæÁ§∫ÂÖ≥Á≥ªÂèòÂåñ‰ø°ÊÅØ
            const changeText = totalRelationshipChange > 0 ? 
                `ÂÖ≥Á≥ªÊÄª‰ΩìÊèêÂçá ${(totalRelationshipChange * 100).toFixed(1)}%` : 
                `ÂÖ≥Á≥ªÊÄª‰Ωì‰∏ãÈôç ${Math.abs(totalRelationshipChange * 100).toFixed(1)}%`;
            
            showNotification(`${participants.join(', ')} Âú®${location}ËøõË°å‰∫Ü${interactionType}Ôºå${changeText}`, 'success');
        }

        // Ëé∑Âèñ‰∫§‰∫íÁ±ªÂûã
        function getInteractionType(participants, location) {
            const locationInteractions = {
                'ÂíñÂï°ÂéÖ': ['Èó≤ËÅä', 'Â∑•‰ΩúËÆ®ËÆ∫', 'ÊîæÊùæ‰∫§Ë∞à', 'ÂïÜÂä°Ê¥ΩË∞à', 'ÂàõÊÑè‰∫§ÊµÅ'],
                'Âõæ‰π¶È¶Ü': ['Â≠¶ÊúØËÆ®ËÆ∫', 'Áü•ËØÜÂàÜ‰∫´', 'ÂÆâÈùô‰∫§ÊµÅ', 'Â≠¶‰π†ÊåáÂØº', 'Á†îÁ©∂Âêà‰Ωú'],
                'ÂÖ¨Âõ≠': ['Êï£Ê≠•ËÅäÂ§©', 'ËøêÂä®‰∫§ÊµÅ', '‰ºëÈó≤ÂØπËØù', 'Êà∑Â§ñÊ¥ªÂä®', 'Ëá™ÁÑ∂Êé¢Á¥¢'],
                'ÂäûÂÖ¨ÂÆ§': ['Â∑•‰ΩúÂçè‰Ωú', '‰∏öÂä°ËÆ®ËÆ∫', 'È°πÁõÆ‰∫§ÊµÅ', 'ÊäÄÊúØÂàÜ‰∫´', 'Âõ¢ÈòüÂª∫ËÆæ'],
                'ÂÆ∂': ['ÁßÅ‰∫∫Ë∞àËØù', 'ÂÆ∂Â∫≠ËØùÈ¢ò', 'Ê∑±ÂÖ•‰∫§ÊµÅ', 'ÊÉÖÊÑüÂàÜ‰∫´', 'ÁîüÊ¥ªËÆ®ËÆ∫'],
                'ÂåªÈô¢': ['ÂÅ•Â∫∑Âí®ËØ¢', 'ÂÖ≥ÊÄÄÂØπËØù', '‰∏ì‰∏ö‰∫§ÊµÅ', 'ÂåªÁñóËÆ®ËÆ∫', 'ÁóÖÊÉÖÂàÜÊûê'],
                'È§êÂéÖ': ['Áî®È§êËÅäÂ§©', 'ÁæéÈ£üËÆ®ËÆ∫', 'Á§æ‰∫§ËÅöÈ§ê', 'ÁÉπÈ•™ÊäÄÂ∑ß', 'È•ÆÈ£üÊñáÂåñ'],
                '‰øÆÁêÜÂ∫ó': ['ÊäÄÊúØ‰∫§ÊµÅ', 'ÂÆûÁî®ËÆ®ËÆ∫', 'ÁªèÈ™åÂàÜ‰∫´', 'Â∑•ÂÖ∑‰ΩøÁî®', 'ÈóÆÈ¢òËß£ÂÜ≥']
            };
            
            const options = locationInteractions[location] || ['‰∏ÄËà¨‰∫§ÊµÅ', 'ÂèãÂ•ΩÂØπËØù', 'ÈöèÊÑèËÅäÂ§©'];
            
            // Ê†πÊçÆÂèÇ‰∏éËÄÖÂÖ≥Á≥ªÂÜ≥ÂÆö‰∫§‰∫íÁ±ªÂûã
            const agentA = participants[0];
            const agentB = participants[1];
            const relationship = gameData.agents[agentA].relationships[agentB];
            
            if (relationship) {
                const strength = relationship.strength;
                
                // ÂÖ≥Á≥ªÂº∫Â∫¶ÂΩ±Âìç‰∫§‰∫íÁ±ªÂûãÊ¶ÇÁéá
                if (strength > 0.7) {
                    // ‰∫≤ÂØÜÊúãÂèãÔºöÊõ¥Â§öÊ≠£Èù¢‰∫§‰∫í
                    const positiveTypes = ['Ê∑±ÂÖ•‰∫§ÊµÅ', 'ÊÉÖÊÑüÂàÜ‰∫´', 'ÂàõÊÑèÂêà‰Ωú', 'Áü•ËØÜÂàÜ‰∫´'];
                    if (Math.random() < 0.7) {
                        return positiveTypes[Math.floor(Math.random() * positiveTypes.length)];
                    }
                } else if (strength < 0.3) {
                    // ÈôåÁîü‰∫∫ÔºöÂèØËÉΩ‰∫ßÁîüË¥üÈù¢‰∫§‰∫í
                    if (Math.random() < 0.3) {
                        const negativeTypes = ['ËØØËß£', 'ÂàÜÊ≠ß', 'Â∞¥Â∞¨ÂØπËØù'];
                        return negativeTypes[Math.floor(Math.random() * negativeTypes.length)];
                    }
                }
            }
            
            return options[Math.floor(Math.random() * options.length)];
        }

        // ËÆ°ÁÆóÂÖ≥Á≥ªÂèòÂåñ
        function calculateRelationshipChange(interactionType, participants, location) {
            const baseChanges = {
                // Ê≠£Èù¢‰∫§‰∫í
                'Èó≤ËÅä': 0.05, 'Â∑•‰ΩúËÆ®ËÆ∫': 0.08, 'Â≠¶ÊúØËÆ®ËÆ∫': 0.1, 'Êï£Ê≠•ËÅäÂ§©': 0.06,
                'ÊäÄÊúØ‰∫§ÊµÅ': 0.09, 'ÁæéÈ£üËÆ®ËÆ∫': 0.07, 'Ê∑±ÂÖ•‰∫§ÊµÅ': 0.12, '‰∏ì‰∏ö‰∫§ÊµÅ': 0.1,
                'ÂàõÊÑè‰∫§ÊµÅ': 0.11, 'Â≠¶‰π†ÊåáÂØº': 0.09, 'Á†îÁ©∂Âêà‰Ωú': 0.12, 'Êà∑Â§ñÊ¥ªÂä®': 0.08,
                'Âõ¢ÈòüÂª∫ËÆæ': 0.11, 'ÊÉÖÊÑüÂàÜ‰∫´': 0.13, 'ÁîüÊ¥ªËÆ®ËÆ∫': 0.08, 'ÁÉπÈ•™ÊäÄÂ∑ß': 0.09,
                'È•ÆÈ£üÊñáÂåñ': 0.08, 'Â∑•ÂÖ∑‰ΩøÁî®': 0.07, 'ÈóÆÈ¢òËß£ÂÜ≥': 0.1,
                
                // Ë¥üÈù¢‰∫§‰∫í
                'ËØØËß£': -0.15, 'ÂàÜÊ≠ß': -0.18, 'Â∞¥Â∞¨ÂØπËØù': -0.12, '‰∫âËÆ∫': -0.20,
                'ÂÜ≤Á™Å': -0.25, 'ËØØËß£': -0.15, '‰∏çÊÑâÂø´': -0.16, 'ÂàÜÊ≠ßËÆ®ËÆ∫': -0.17
            };
            
            let change = baseChanges[interactionType] || 0.05;
            
            // ‰ΩçÁΩÆÊïàÊûú
            const locationEffects = {
                'ÂíñÂï°ÂéÖ': 1.1, 'Âõæ‰π¶È¶Ü': 1.0, 'ÂÖ¨Âõ≠': 1.2, 'ÂäûÂÖ¨ÂÆ§': 0.9,
                'ÂÆ∂': 1.3, 'ÂåªÈô¢': 0.8, 'È§êÂéÖ': 1.1, '‰øÆÁêÜÂ∫ó': 0.9
            };
            
            change *= (locationEffects[location] || 1.0);
            
            // ÂèÇ‰∏éËÄÖÊï∞ÈáèÊïàÊûú
            if (participants.length > 2) {
                change *= 0.8; // Áæ§‰Ωì‰∫§‰∫íÊïàÊûúÁ®çÂº±
            }
            
            // ÂÖ≥Á≥ªÂº∫Â∫¶ÊïàÊûú
            const agentA = participants[0];
            const agentB = participants[1];
            const relationship = gameData.agents[agentA].relationships[agentB];
            
            if (relationship) {
                if (change > 0) {
                    // Ê≠£Èù¢ÂèòÂåñÔºöÂÖ≥Á≥ªË∂äÂº∫ÔºåÂ¢ûÈïøË∂äÊÖ¢
                    if (relationship.strength > 0.7) {
                        change *= 0.7;
                    } else if (relationship.strength < 0.3) {
                        change *= 1.3;
                    }
                } else {
                    // Ë¥üÈù¢ÂèòÂåñÔºöÂÖ≥Á≥ªË∂äÂº∫Ôºå‰º§ÂÆ≥Ë∂äÊ∑±
                    if (relationship.strength > 0.7) {
                        change *= 1.2;
                    } else if (relationship.strength < 0.3) {
                        change *= 0.8;
                    }
                }
            }
            
            return change;
        }

        // Êõ¥Êñ∞ÂÖ≥Á≥ªÂº∫Â∫¶
        function updateRelationship(agentA, agentB, interactionType, participants, location) {
            const relationship = gameData.agents[agentA].relationships[agentB];
            if (relationship) {
                // ËÆ°ÁÆóÂÖ≥Á≥ªÂèòÂåñ
                const change = calculateRelationshipChange(interactionType, participants, location);
                
                // Â∫îÁî®ÂèòÂåñ
                relationship.strength = Math.max(0.1, Math.min(1.0, relationship.strength + change));
                relationship.interactions += 1;
                relationship.lastMet = new Date().toISOString();
                
                // ËÆ∞ÂΩï‰∫§‰∫íÂéÜÂè≤
                relationship.interactionHistory.push({
                    type: interactionType,
                    change: change,
                    timestamp: new Date().toISOString(),
                    location: location,
                    participants: participants
                });
                
                // ÈôêÂà∂ÂéÜÂè≤ËÆ∞ÂΩïÊï∞Èáè
                if (relationship.interactionHistory.length > 20) {
                    relationship.interactionHistory = relationship.interactionHistory.slice(-20);
                }
                
                // Êõ¥Êñ∞ÂÖ≥Á≥ªÁ≠âÁ∫ß
                relationship.relationshipLevel = getRelationshipLevel(relationship.strength);
                
                // Ê∑ªÂä†ËØùÈ¢ò
                if (!relationship.topics.includes(interactionType)) {
                    relationship.topics.push(interactionType);
                }
                
                // Êõ¥Êñ∞Âú∞ÁÇπÁÉ≠Â∫¶
                if (gameData.locationPopularity[location]) {
                    gameData.locationPopularity[location].interactions = 
                        (gameData.locationPopularity[location].interactions || 0) + 1;
                    gameData.locationPopularity[location].popularityScore += 0.1;
                    gameData.locationPopularity[location].lastActivity = new Date();
                }
                
                return change;
            }
            return 0;
        }

        // ÁîüÊàêÁæ§‰ΩìÂØπËØù
        function generateGroupConversation(participants, interactionType, location) {
            const conversation = [];
            const agentTemplates = {
                'Alex': ['‰ªéÊäÄÊúØËßíÂ∫¶Êù•ËØ¥...', 'ÊàëËßâÂæóÂèØ‰ª•Áî®ÁºñÁ®ãÊÄùÁª¥Ëß£ÂÜ≥', 'ËøôËÆ©ÊàëÊÉ≥Âà∞‰∫ÜÁÆóÊ≥ïÈóÆÈ¢ò'],
                'Emma': ['ËøôÂæàÊúâËâ∫ÊúØÊÑüÔºÅ', 'ÊàëÊÉ≥Áîª‰∏ãËøô‰∏™Âú∫ÊôØ', 'ÂàõÊÑèÂ∞±ÊòØËøôÊ†∑‰∫ßÁîüÁöÑ'],
                'Sarah': ['ËøôÊòØ‰∏™ÂæàÂ•ΩÁöÑÂ≠¶‰π†Êú∫‰ºö', 'ËÆ©ÊàëÊù•ÂàÜ‰∫´‰∏Ä‰∫õÁªèÈ™å', 'ÊïôËÇ≤ÁöÑÊú¨Ë¥®ÊòØ...'],
                'David': ['‰ªéÂïÜ‰∏öËßíÂ∫¶ËÄÉËôë', 'ËøôÊúâÂæàÂ§ßÁöÑÂ∏ÇÂú∫ÊΩúÂäõ', 'Êàë‰ª¨ÂèØ‰ª•Âêà‰Ωú...'],
                'Lisa': ['Â§™ÊúâË∂£‰∫ÜÔºÅ', 'ÊàëË¶ÅËÆ∞ÂΩï‰∏ãÊù•', 'ËÉΩËØ¶ÁªÜËØ¥ËØ¥ÂêóÔºü'],
                'Mike': ['Âπ¥ËΩªÊó∂Êàë‰πüÈÅáÂà∞Ëøá', 'ÁªèÈ™åÂëäËØâÊàë...', '‰∫∫ÁîüÂ¶ÇËå∂...'],
                'John': ['‰ªéÂåªÂ≠¶ËßíÂ∫¶Áúã', 'ÂÅ•Â∫∑ÂæàÈáçË¶Å', 'È¢ÑÈò≤ËÉú‰∫éÊ≤ªÁñó'],
                'Anna': ['ËøôËÆ©ÊàëÊÉ≥Âà∞ÁæéÈ£ü', 'ÁÉπÈ•™ÂíåÁîüÊ¥ª‰∏ÄÊ†∑', 'Âë≥ÈÅìÊòØÊÉÖÊÑüÁöÑË°®Ëææ'],
                'Tom': ['ÂÆûÈôÖÊìç‰ΩúÊòØÂÖ≥ÈîÆ', 'Âä®ÊâãËÉΩÂäõÂæàÈáçË¶Å', 'Â∑•ÂÖ∑ÂíåÊäÄÂ∑ß...']
            };
            
            participants.forEach((participant, index) => {
                const templates = agentTemplates[participant] || ['ÊàëËßâÂæó...', 'ÊúâÈÅìÁêÜ', 'Á°ÆÂÆûÂ¶ÇÊ≠§'];
                const response = templates[Math.floor(Math.random() * templates.length)];
                conversation.push({
                    speaker: participant,
                    message: `${response}ÂÖ≥‰∫é${interactionType}ÁöÑËØùÈ¢ò„ÄÇ`
                });
            });
            
            return conversation;
        }

        // ÊòæÁ§∫‰∫§‰∫íËÆ∞ÂΩï
        function displayInteraction(interaction) {
            const feed = document.getElementById('interactionFeed');
            
            // Ê∏ÖÁ©∫ÂàùÂßãÊèêÁ§∫
            if (feed.children.length === 1 && feed.children[0].style.textAlign === 'center') {
                feed.innerHTML = '';
            }
            
            const interactionDiv = document.createElement('div');
            interactionDiv.className = 'interaction-item';
            
            const participantTags = interaction.participants.map(name => 
                `<span class="participant-tag">${gameData.agents[name].emoji} ${name}</span>`
            ).join('');
            
            const conversationText = interaction.conversation.map(conv => 
                `<strong>${conv.speaker}:</strong> ${conv.message}`
            ).join('<br>');
            
            interactionDiv.innerHTML = `
                <div class="interaction-header">
                    <i class="fas fa-clock"></i>
                    <span>${interaction.timestamp}</span>
                    <span>‚Ä¢</span>
                    <i class="fas fa-map-marker-alt"></i>
                    <span>${interaction.location}</span>
                    <span>‚Ä¢</span>
                    <span>${interaction.type}</span>
                </div>
                <div class="interaction-participants">
                    ${participantTags}
                </div>
                <div class="interaction-content">
                    ${conversationText}
                </div>
            `;
            
            feed.insertBefore(interactionDiv, feed.firstChild);
            
            // ÈôêÂà∂ÊòæÁ§∫ÁöÑ‰∫§‰∫íÊï∞Èáè
            while (feed.children.length > 20) {
                feed.removeChild(feed.lastChild);
            }
        }

        // ÊòæÁ§∫Á§æ‰∫§ÁΩëÁªú
        function showSocialNetwork() {
            const modal = document.getElementById('socialNetworkModal');
            const content = document.getElementById('socialNetworkContent');
            
            let html = '<div class="relationship-grid">';
            
            Object.entries(gameData.agents).forEach(([agentName, agent]) => {
                html += `
                    <div class="relationship-card">
                        <div class="relationship-header">
                            <span style="font-size: 1.5rem;">${agent.emoji}</span>
                            <div>
                                <h4 style="margin: 0;">${agentName}</h4>
                                <p style="margin: 0; font-size: 0.8rem; color: var(--text-secondary);">${agent.occupation}</p>
                            </div>
                        </div>
                        <div style="margin-top: 10px;">
                `;
                
                // ÊòæÁ§∫‰∏éÂÖ∂‰ªñagentÁöÑÂÖ≥Á≥ª
                Object.entries(agent.relationships || {}).forEach(([otherAgent, relationship]) => {
                    const strengthPercent = Math.round(relationship.strength * 100);
                    const strengthColor = relationship.strength > 0.7 ? 'var(--success)' : 
                                         relationship.strength > 0.4 ? 'var(--warning)' : 'var(--error)';
                    
                    html += `
                        <div class="relationship-strength">
                            <span style="font-size: 0.9rem;">${gameData.agents[otherAgent].emoji} ${otherAgent}</span>
                            <div class="strength-bar">
                                <div class="strength-fill" style="width: ${strengthPercent}%; background: ${strengthColor};"></div>
                            </div>
                            <span>${strengthPercent}%</span>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            });
            
            html += '</div>';
            content.innerHTML = html;
            modal.classList.add('show');
        }

        // ÂÖ≥Èó≠Á§æ‰∫§ÁΩëÁªúÊ®°ÊÄÅÊ°Ü
        function closeSocialNetwork() {
            document.getElementById('socialNetworkModal').classList.remove('show');
        }

        // ÁªÑÁªáÁæ§‰ΩìÊ¥ªÂä®
        function organizeGroupActivity() {
            const activities = [
                {name: 'Âõæ‰π¶È¶ÜËØª‰π¶‰ºö', location: 'Âõæ‰π¶È¶Ü', participants: ['Sarah', 'Lisa', 'Alex']},
                {name: 'ÂÖ¨Âõ≠ÈáéÈ§êËÅö‰ºö', location: 'ÂÖ¨Âõ≠', participants: ['Emma', 'Mike', 'Anna']},
                {name: 'ÂíñÂï°ÂéÖÂïÜÂä°Ê¥ΩË∞à', location: 'ÂíñÂï°ÂéÖ', participants: ['David', 'Alex', 'John']},
                {name: 'È§êÂéÖÁæéÈ£üÂìÅÈâ¥', location: 'È§êÂéÖ', participants: ['Anna', 'Emma', 'Sarah']},
                {name: 'ÂäûÂÖ¨ÂÆ§ÊäÄÊúØËÆ®ËÆ∫', location: 'ÂäûÂÖ¨ÂÆ§', participants: ['Alex', 'Tom', 'David']},
                {name: 'ÂåªÈô¢ÂÅ•Â∫∑ËÆ≤Â∫ß', location: 'ÂåªÈô¢', participants: ['John', 'Sarah', 'Mike']}
            ];
            
            const activity = activities[Math.floor(Math.random() * activities.length)];
            
            // ÁßªÂä®participantsÂà∞ÊåáÂÆö‰ΩçÁΩÆ
            const building = gameData.buildings.find(b => b.name === activity.location);
            if (building) {
                activity.participants.forEach(agentName => {
                    if (gameData.agents[agentName]) {
                        gameData.agents[agentName].x = building.x;
                        gameData.agents[agentName].y = building.y;
                        gameData.agents[agentName].location = building.name;
                    }
                });
                
                // Ëß¶ÂèëÁæ§‰Ωì‰∫§‰∫í
                executeAgentInteraction(activity.participants);
                
                generateMap();
                generateAgentCards();
                
                showNotification(`ÁªÑÁªá‰∫Ü${activity.name}ÔºåÂèÇ‰∏éËÄÖÔºö${activity.participants.join(', ')}`, 'success');
            }
        }

        // ÊòæÁ§∫Âú∞ÁÇπÁªüËÆ°
        function showLocationStats() {
            let statsText = "üìä Âú∞ÁÇπÁÉ≠Â∫¶ÁªüËÆ°:\n\n";
            
            Object.entries(gameData.locationPopularity).forEach(([location, stats]) => {
                const currentCount = Object.values(gameData.agents).filter(agent => agent.location === location).length;
                statsText += `${gameData.buildings.find(b => b.name === location)?.emoji || 'üìç'} ${location}:\n`;
                statsText += `  ÂΩìÂâç‰∫∫Êï∞: ${currentCount}\n`;
                statsText += `  ‰∫§‰∫íÊ¨°Êï∞: ${stats.interactions || 0}\n`;
                statsText += `  ÁÉ≠Â∫¶ÂàÜÊï∞: ${(stats.popularityScore || 0).toFixed(1)}\n\n`;
            });
            
            alert(statsText);
        }

        // ÂàáÊç¢Ëá™Âä®‰∫§‰∫í
        function toggleAutoInteraction() {
            gameData.autoInteraction = !gameData.autoInteraction;
            const button = document.getElementById('autoInteractionText');
            button.textContent = gameData.autoInteraction ? 'ÂÖ≥Èó≠Ëá™Âä®‰∫§‰∫í' : 'ÂºÄÂêØËá™Âä®‰∫§‰∫í';
            
            showNotification(
                gameData.autoInteraction ? 'Ëá™Âä®‰∫§‰∫íÂ∑≤ÂºÄÂêØ' : 'Ëá™Âä®‰∫§‰∫íÂ∑≤ÂÖ≥Èó≠',
                'success'
            );
        }

        // Ê∏ÖÁ©∫‰∫§‰∫íÂéÜÂè≤
        function clearInteractionHistory() {
            gameData.agentInteractions = [];
            const feed = document.getElementById('interactionFeed');
            feed.innerHTML = `
                <div style="text-align: center; color: var(--text-secondary); padding: 20px;">
                    <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 10px; opacity: 0.3;"></i>
                    <p>Á≠âÂæÖAgentÈó¥ÁöÑ‰∫§‰∫í...</p>
                </div>
            `;
            showNotification('‰∫§‰∫íÂéÜÂè≤Â∑≤Ê∏ÖÁ©∫', 'success');
        }

        function generateAgentResponse(agentName, message) {
            const agent = gameData.agents[agentName];
            
            // Âü∫‰∫éAgentÊÄßÊ†ºÂíå‰∏ìÈïøÁîüÊàêÊô∫ËÉΩÂõûÂ§ç
            const responseTemplates = {
                'Alex': {
                    keywords: ['ÁºñÁ®ã', 'ÁÆóÊ≥ï', 'ÊäÄÊúØ', 'ÈÄªËæë', '‰ª£Á†Å', 'È°πÁõÆ'],
                    responses: [
                        "‰ªéÁ®ãÂ∫èÂëòÁöÑËßíÂ∫¶Êù•ÁúãÔºåËøô‰∏™ÈóÆÈ¢òÂæàÊúâÊÑèÊÄùÔºÅÊàëËßâÂæóÂèØ‰ª•Áî®ÁÆóÊ≥ïÁöÑÊÄùÁª¥Êù•Ëß£ÂÜ≥„ÄÇ",
                        "ËÆ©ÊàëÊÉ≥ÊÉ≥...ËøôÂ∞±ÂÉèË∞ÉËØï‰ª£Á†Å‰∏ÄÊ†∑ÔºåÈúÄË¶ÅÈÄêÊ≠•ÂàÜÊûêÈóÆÈ¢òÁöÑÊ†πÊ∫ê„ÄÇ",
                        "ÁºñÁ®ãÊïô‰ºö‰∫ÜÊàëÈÄªËæëÊÄùÁª¥ÔºåÊàëËÆ§‰∏∫‰ªª‰ΩïÈóÆÈ¢òÈÉΩÊúâÊúÄ‰ºòËß£„ÄÇ",
                        "ËøôËÆ©ÊàëÊÉ≥Âà∞‰∫Ü‰∏Ä‰∏™ÊàëÊúÄËøëÂú®ÂÅöÁöÑÈ°πÁõÆÔºåÊäÄÊúØÁúüÁöÑÂæàÁ•ûÂ•áÔºÅ",
                        "‰ªéÊäÄÊúØËßíÂ∫¶ÂàÜÊûêÔºåËøô‰∏™ÈóÆÈ¢òÂèØ‰ª•ËøôÊ†∑Ëß£ÂÜ≥...",
                        "‰ª£Á†Å‰∏ñÁïåÈáåÁöÑÈÄªËæëÊÄùÁª¥ÔºåËÆ©ÊàëÂØπËøô‰∏™ÈóÆÈ¢òÊúâ‰∫ÜÊñ∞ÁöÑÁêÜËß£„ÄÇ"
                    ]
                },
                'Emma': {
                    keywords: ['Ëâ∫ÊúØ', 'Âàõ‰Ωú', 'Ëâ≤ÂΩ©', 'ÁæéÂ≠¶', 'ÁÅµÊÑü', 'ËÆæËÆ°'],
                    responses: [
                        "ËøôÊøÄÂèë‰∫ÜÊàëÁöÑÂàõ‰ΩúÁÅµÊÑüÔºÅÊàëÊÉ≥Áî®ÁîªÁ¨îËÆ∞ÂΩï‰∏ãËøôÁßçÊÑüËßâ„ÄÇ",
                        "Ëâ∫ÊúØÊù•Ê∫ê‰∫éÁîüÊ¥ªÔºå‰Ω†ÁöÑËØùËÆ©ÊàëÁúãÂà∞‰∫ÜÊñ∞ÁöÑËâ≤ÂΩ©ÂíåÂèØËÉΩÊÄß„ÄÇ",
                        "ÊØè‰∏™‰∫∫ÈÉΩÊúâËá™Â∑±ÁöÑÁæéÂ≠¶ËßÇÁÇπÔºåËøôÂ∞±ÊòØËâ∫ÊúØÁöÑÈ≠ÖÂäõÊâÄÂú®„ÄÇ",
                        "ÊàëÊ≠£Âú®Âàõ‰Ωú‰∏Ä‰∏™Êñ∞‰ΩúÂìÅÔºå‰πüËÆ∏ÂèØ‰ª•Âä†ÂÖ•Ëøô‰∫õÂÖÉÁ¥†„ÄÇ",
                        "‰ªéËâ∫ÊúØÁöÑËßíÂ∫¶ÁúãÔºåËøô‰∏™ÈóÆÈ¢òÂÖÖÊª°‰∫ÜÁæéÊÑü„ÄÇ",
                        "Ëâ≤ÂΩ©ÂíåÂΩ¢Áä∂ÁöÑÁªÑÂêàÔºåËÆ©ÊàëÊÉ≥Âà∞‰∫Ü‰∏Ä‰∏™ÂàõÊÑèÊñπÊ°à„ÄÇ"
                    ]
                },
                'Sarah': {
                    keywords: ['ÊïôËÇ≤', 'Â≠¶‰π†', 'Áü•ËØÜ', 'ÊïôÂ≠¶', 'ÊåáÂØº', 'ÁªèÈ™å'],
                    responses: [
                        "‰Ωú‰∏∫ËÄÅÂ∏àÔºåÊàëÂæàÂñúÊ¨¢ËøôÊ†∑ÁöÑ‰∫§ÊµÅÔºÅËøôÊòØÂæàÂ•ΩÁöÑÂ≠¶‰π†Êú∫‰ºö„ÄÇ",
                        "ÊïôËÇ≤ÁöÑÊú¨Ë¥®ÊòØÂêØÂèëÊÄùËÄÉÔºå‰Ω†ÁöÑËßÇÁÇπÂæàÊúâÂêØÂèëÊÄß„ÄÇ",
                        "ÊàëÁªèÂ∏∏ÂíåÂ≠¶Áîü‰ª¨ËÆ®ËÆ∫Á±ª‰ººÁöÑËØùÈ¢òÔºåÁü•ËØÜÁöÑÂàÜ‰∫´ËÆ©‰∫∫Âø´‰πê„ÄÇ",
                        "ËÆ©Êàë‰ª¨‰∏ÄËµ∑Êé¢ËÆ®Ëøô‰∏™ÈóÆÈ¢òÔºåÊàëÂèØ‰ª•ÂàÜ‰∫´‰∏Ä‰∫õÊàëÁöÑÊïôÂ≠¶ÁªèÈ™å„ÄÇ",
                        "‰ªéÊïôËÇ≤ËßíÂ∫¶ÁúãÔºåËøô‰∏™ÈóÆÈ¢òÂæàÊúâ‰ª∑ÂÄº„ÄÇ",
                        "ÊïôÂ≠¶Áõ∏ÈïøÔºå‰Ω†ÁöÑÊÉ≥Ê≥ï‰πüËÆ©ÊàëÂ≠¶Âà∞‰∫ÜÊñ∞‰∏úË•ø„ÄÇ"
                    ]
                },
                'David': {
                    keywords: ['ÂïÜ‰∏ö', 'ÊäïËµÑ', 'Â∏ÇÂú∫', 'Á≠ñÁï•', 'Êú∫‰ºö', 'Âêà‰Ωú'],
                    responses: [
                        "‰ªéÂïÜ‰∏öËßíÂ∫¶Êù•ÁúãÔºåËøôÈáåÈù¢ÊúâÂæàÂ§ßÁöÑ‰ª∑ÂÄºÂíåÊú∫‰ºöÔºÅ",
                        "ÊàêÂäüÈúÄË¶ÅÁ≠ñÁï•ÂíåÊâßË°åÂäõÔºåÊàë‰ª¨Êù•ÂàÜÊûê‰∏Ä‰∏ãÂèØË°åÊÄß„ÄÇ",
                        "ÂïÜÂú∫Â¶ÇÊàòÂú∫Ôºå‰ΩÜÂêà‰ΩúÂÖ±Ëµ¢ÊâçÊòØÈïø‰πÖ‰πãÈÅì„ÄÇ",
                        "ÊàëÊúÄËøëÂú®Ë∞à‰∏Ä‰∏™È°πÁõÆÔºå‰Ω†ÁöÑÊÉ≥Ê≥ïÁªô‰∫ÜÊàëÊñ∞ÁöÑÊÄùË∑Ø„ÄÇ",
                        "Â∏ÇÂú∫ÂàÜÊûêÂëäËØâÊàëÔºåËøô‰∏™ÊñπÂêëÂæàÊúâÊΩúÂäõ„ÄÇ",
                        "ÂïÜ‰∏öÊÄùÁª¥Â∞±ÊòØË¶ÅÁúãÂà∞Âà´‰∫∫Áúã‰∏çÂà∞ÁöÑÊú∫‰ºö„ÄÇ"
                    ]
                },
                'Lisa': {
                    keywords: ['Â≠¶‰π†', 'Êé¢Á¥¢', 'ÊèêÈóÆ', 'Âê∏Êî∂', 'ËÄÉËØï', 'ÂêåÂ≠¶'],
                    responses: [
                        "ÂìáÔºåÂ§™ÊúâË∂£‰∫ÜÔºÅÊàëË¶ÅÊääËøô‰∏™ËÆ∞ÂΩï‰∏ãÊù•ÔºåËØ¥‰∏çÂÆöËÄÉËØï‰ºöÁî®Âà∞„ÄÇ",
                        "Â≠¶‰π†ÁúüÁöÑÂæàÂø´‰πêÔºåÊØèÂ§©ÈÉΩËÉΩÂ≠¶Âà∞Êñ∞‰∏úË•øÔºÅ",
                        "‰Ω†ËÉΩËØ¶ÁªÜËß£Èáä‰∏Ä‰∏ãÂêóÔºüÊàëÊÉ≥Êõ¥Ê∑±ÂÖ•Âú∞ÁêÜËß£Ëøô‰∏™Ê¶ÇÂøµ„ÄÇ",
                        "ÊàëÂáÜÂ§áÊääËøô‰∏™ÂàÜ‰∫´ÁªôÂêåÂ≠¶‰ª¨ÔºåÂ§ßÂÆ∂‰∏ÄËµ∑ËÆ®ËÆ∫‰ºöÊõ¥ÊúâÊÑèÊÄù„ÄÇ",
                        "Ëøô‰∏™ÈóÆÈ¢òËÆ©ÊàëÊÉ≥Âà∞‰∫ÜËØæÊú¨‰∏äÁöÑÂÜÖÂÆπ„ÄÇ",
                        "Â≠¶‰π†Êñ∞Áü•ËØÜÁöÑÊÑüËßâÁúüÁöÑÂæàÊ£íÔºÅ"
                    ]
                },
                'Mike': {
                    keywords: ['ÁªèÈ™å', '‰∫∫Áîü', 'ÊïÖ‰∫ã', 'Êô∫ÊÖß', 'Âπ¥ËΩª', 'ÈÄÄ‰ºë'],
                    responses: [
                        "Âπ¥ËΩªÊó∂Êàë‰πüÈÅáÂà∞ËøáÁ±ª‰ººÁöÑÊÉÖÂÜµÔºåÁªèÈ™åÂëäËØâÊàë...",
                        "‰∫∫ÁîüÂ¶ÇËå∂ÔºåÈúÄË¶ÅÊÖ¢ÊÖ¢ÂìÅÂë≥„ÄÇÊàëÊúâÂæàÂ§öÊïÖ‰∫ãÂèØ‰ª•ÂàÜ‰∫´„ÄÇ",
                        "Áé∞Âú®ÁöÑÂπ¥ËΩª‰∫∫ÁúüÊúâÊÉ≥Ê≥ïÔºåÊàë‰ª¨ÈÇ£‰∏™Êó∂‰ª£ÂèØÊ≤°ÊúâËøô‰∫õ„ÄÇ",
                        "ÈÄÄ‰ºëÂêéÊàëÊúâ‰∫ÜÊõ¥Â§öÊó∂Èó¥ÊÄùËÄÉÔºåÁîüÊ¥ªÁöÑÊô∫ÊÖßÈúÄË¶ÅÊ≤âÊ∑Ä„ÄÇ",
                        "‰∫∫ÁîüÁªèÈ™åÂëäËØâÊàëÔºåËøô‰∏™ÈóÆÈ¢òÈúÄË¶ÅËøôÊ†∑Â§ÑÁêÜ...",
                        "Âπ¥ËΩªÊó∂ÁöÑÁªèÂéÜÔºåËÆ©ÊàëÂØπËøô‰∏™ÈóÆÈ¢òÊúâ‰∫ÜÊ∑±ÂàªÁöÑÁêÜËß£„ÄÇ"
                    ]
                },
                'John': {
                    keywords: ['ÂåªÁñó', 'ÂÅ•Â∫∑', 'ËØäÊñ≠', 'ÂÖ≥ÊÄÄ', 'ÁóÖ‰∫∫', 'È¢ÑÈò≤'],
                    responses: [
                        "‰ªéÂåªÂ≠¶ËßíÂ∫¶Êù•ÁúãÔºåËøô‰∏™ÈóÆÈ¢òÂæàÈáçË¶Å„ÄÇÂÅ•Â∫∑Ê∞∏ËøúÊòØÁ¨¨‰∏Ä‰ΩçÁöÑ„ÄÇ",
                        "È¢ÑÈò≤ËÉú‰∫éÊ≤ªÁñóÔºåÊàë‰ª¨Ë¶Å‰ªéÊ†πÊ∫ê‰∏äËß£ÂÜ≥ÈóÆÈ¢ò„ÄÇ",
                        "‰Ωú‰∏∫ÂåªÁîüÔºåÊàëËßÅËøáÂ§™Â§öÊ°à‰æãÔºåÊØè‰∏™‰∫∫ÁöÑÊÉÖÂÜµÈÉΩ‰∏çÂêå„ÄÇ",
                        "ÂåªËÄÖ‰ªÅÂøÉÔºåÊàëÂ∏åÊúõËÉΩÂ∏ÆÂä©Âà∞Êõ¥Â§öÁöÑ‰∫∫„ÄÇ",
                        "‰ªéÂÅ•Â∫∑ËßíÂ∫¶ËÄÉËôëÔºåËøô‰∏™ÈóÆÈ¢òÈúÄË¶ÅÈáçËßÜ„ÄÇ",
                        "ÂåªÁñóÁªèÈ™åÂëäËØâÊàëÔºåÈ¢ÑÈò≤ÊØîÊ≤ªÁñóÊõ¥ÈáçË¶Å„ÄÇ"
                    ]
                },
                'Anna': {
                    keywords: ['ÁÉπÈ•™', 'ÁæéÈ£ü', 'È£üÊùê', 'Âë≥ÈÅì', 'Âé®Êàø', 'ÊâãËâ∫'],
                    responses: [
                        "ËøôËÆ©ÊàëÊÉ≥Âà∞‰∫ÜÁæéÈ£üÔºÅÂ•ΩÁöÑÈ£üÊùêÈÖç‰∏äÂ•ΩÂøÉÊÉÖÔºåÂ∞±ÊòØÂÆåÁæéÁöÑËèúËÇ¥„ÄÇ",
                        "ÁÉπÈ•™Â∞±ÂÉèÁîüÊ¥ªÔºåÈúÄË¶ÅÁî®ÂøÉË∞ÉÂë≥ÔºåÊØè‰∏ÄÈÅìËèúÈÉΩÊúâÊïÖ‰∫ã„ÄÇ",
                        "‰Ω†ÊÉ≥Â∞ùÂ∞ùÊàëÁöÑÊãøÊâãËèúÂêóÔºüÊàë‰øùËØÅ‰ºöËÆ©‰Ω†ÂõûÂë≥Êó†Á©∑ÔºÅ",
                        "Âé®ÊàøÊòØÊàëÁöÑËâ∫ÊúØÂ∑•‰ΩúÂÆ§ÔºåÊØè‰∏ÄÊ¨°Âàõ‰ΩúÈÉΩÊòØÂØπÂë≥ËïæÁöÑÊåëÊàò„ÄÇ",
                        "‰ªéÁæéÈ£üËßíÂ∫¶ÁúãÔºåËøô‰∏™ÈóÆÈ¢òÂæàÊúâÂë≥ÈÅì„ÄÇ",
                        "ÁÉπÈ•™ÊäÄÂ∑ßÂëäËØâÊàëÔºåÁªÜËäÇÂÜ≥ÂÆöÊàêË¥•„ÄÇ"
                    ]
                },
                'Tom': {
                    keywords: ['Áª¥‰øÆ', 'Â∑•ÂÖ∑', 'ÊäÄËÉΩ', 'Âä®Êâã', 'ÂÆûË∑µ', 'ÈóÆÈ¢ò'],
                    responses: [
                        "ËøôÈúÄË¶ÅÂÆûÈôÖÂä®ÊâãÊù•Ëß£ÂÜ≥ÔºåÁêÜËÆ∫Áü•ËØÜË¶ÅÁªìÂêàÂÆûË∑µ„ÄÇ",
                        "Êàë‰øÆËøáÂêÑÁßçÂêÑÊ†∑ÁöÑ‰∏úË•øÔºåÂÆûË∑µÂá∫ÁúüÁü•ÊòØÊàëÁöÑÂ∫ßÂè≥Èì≠„ÄÇ",
                        "Â∑•ÂÖ∑ÂíåÊäÄÂ∑ßÂæàÈáçË¶ÅÔºå‰ΩÜÊõ¥ÈáçË¶ÅÁöÑÊòØÂØπÈóÆÈ¢òÁöÑÁêÜËß£„ÄÇ",
                        "ËÆ©ÊàëÁúãÁúãÊúâ‰ªÄ‰πàÂèØ‰ª•ÊîπËøõÁöÑÂú∞ÊñπÔºåÊàëÂñúÊ¨¢Ëß£ÂÜ≥ÂÆûÈôÖÈóÆÈ¢ò„ÄÇ",
                        "‰ªéÂÆûÁî®ËßíÂ∫¶ÁúãÔºåËøô‰∏™ÈóÆÈ¢òÈúÄË¶ÅÂä®ÊâãËß£ÂÜ≥„ÄÇ",
                        "Áª¥‰øÆÁªèÈ™åÂëäËØâÊàëÔºåÈóÆÈ¢òÂæÄÂæÄÂú®ÁªÜËäÇ‰∏≠„ÄÇ"
                    ]
                }
            };
            
            const template = responseTemplates[agentName];
            if (template) {
                // Ê£ÄÊü•Ê∂àÊÅØ‰∏≠ÊòØÂê¶ÂåÖÂê´Agent‰∏ìÈïøÁöÑÂÖ≥ÈîÆËØç
                const hasExpertise = template.keywords.some(keyword => 
                    message.includes(keyword) || agent.expertise.some(exp => exp.includes(keyword))
                );
                
                if (hasExpertise) {
                    // Â¶ÇÊûúÊ∂âÂèä‰∏ìÈïøÔºåÁîüÊàêÊõ¥‰∏ì‰∏öÁöÑÂõûÂ§ç
                    const professionalResponses = [
                        `‰Ωú‰∏∫${agent.occupation}ÔºåÊàëÂØπËøô‰∏™ÈóÆÈ¢òÂæàÊúâÁ†îÁ©∂„ÄÇ${template.responses[Math.floor(Math.random() * template.responses.length)]}`,
                        `‰ªéÊàëÁöÑ‰∏ì‰∏öËßíÂ∫¶Êù•ÁúãÔºå${template.responses[Math.floor(Math.random() * template.responses.length)]}`,
                        `ËøôÊ≠£Â•ΩÊòØÊàëÁöÑ‰∏ìÈïøÈ¢ÜÂüüÔºÅ${template.responses[Math.floor(Math.random() * template.responses.length)]}`
                    ];
                    return professionalResponses[Math.floor(Math.random() * professionalResponses.length)];
                } else {
                    // ‰∏ÄËà¨ÂõûÂ§ç
                    return template.responses[Math.floor(Math.random() * template.responses.length)];
                }
            }
            
            // ÈªòËÆ§ÂõûÂ§ç
            const defaultResponses = [
                "ÊàëÁêÜËß£‰Ω†ÁöÑÊÑèÊÄùÔºåËøôÁ°ÆÂÆûÂÄºÂæóÊÄùËÄÉ„ÄÇ",
                "ÊØè‰∏™‰∫∫ÈÉΩÊúâ‰∏çÂêåÁöÑËßÇÁÇπÔºåËøôÂæàÊ≠£Â∏∏„ÄÇ",
                "Ë∞¢Ë∞¢‰Ω†ÁöÑÂàÜ‰∫´ÔºåÊàëÂ≠¶Âà∞‰∫ÜÊñ∞‰∏úË•ø„ÄÇ",
                "Ëøô‰∏™ÈóÆÈ¢òÂæàÊúâË∂£ÔºåËÆ©ÊàëÊÉ≥ÊÉ≥...",
                "‰ªéÊàëÁöÑËßíÂ∫¶Êù•ËØ¥ÔºåËøô‰∏™ÊÉ≥Ê≥ïÂæàÊúâÈÅìÁêÜ„ÄÇ"
            ];
            
            return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
        }

        // ËÅäÂ§©ÂêéÊõ¥Êñ∞AgentÁä∂ÊÄÅ
        function updateAgentAfterChat(agentName) {
            const agent = gameData.agents[agentName];
            
            // ÈöèÊú∫Ë∞ÉÊï¥ËÉΩÈáèÂíåÂøÉÊÉÖ
            agent.energy = Math.max(10, Math.min(100, agent.energy + Math.floor(Math.random() * 11) - 5));
            
            const moods = ['ÂºÄÂøÉ', '‰∏ìÊ≥®', 'ÊîæÊùæ', 'ÊÄùËÄÉ‰∏≠', 'ÂÖ¥Â•ã', 'Âπ≥Èùô'];
            if (Math.random() < 0.3) { // 30%Ê¶ÇÁéáÊîπÂèòÂøÉÊÉÖ
                agent.mood = moods[Math.floor(Math.random() * moods.length)];
            }
            
            // Âà∑Êñ∞ÊòæÁ§∫
            generateAgentCards();
            generateMap();
        }

        // Âø´ÈÄüÊ∂àÊÅØ
        function quickMessage(message) {
            document.getElementById('messageInput').value = message;
        }

        // Ê∏ÖÁ©∫ËÅäÂ§©
        function clearChat() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = `
                <div style="text-align: center; color: var(--text-secondary); margin: auto;">
                    <i class="fas fa-comments" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
                    <p>ËÅäÂ§©ËÆ∞ÂΩïÂ∑≤Ê∏ÖÁ©∫</p>
                </div>
            `;
            gameData.chatHistory = [];
            showNotification('ËÅäÂ§©ËÆ∞ÂΩïÂ∑≤Ê∏ÖÁ©∫', 'success');
        }

        // ÈöèÊú∫ÁßªÂä®Agent
        function randomizeAgents() {
            Object.entries(gameData.agents).forEach(([name, agent]) => {
                const building = gameData.buildings[Math.floor(Math.random() * gameData.buildings.length)];
                agent.x = building.x;
                agent.y = building.y;
                agent.location = building.name;
                
                // Êõ¥Êñ∞ÂøÉÊÉÖ
                const moodEffects = {
                    'ÂíñÂï°ÂéÖ': 'ÊîæÊùæ', 'Âõæ‰π¶È¶Ü': '‰∏ìÊ≥®', 'ÂÖ¨Âõ≠': 'ÂºÄÂøÉ',
                    'ÂäûÂÖ¨ÂÆ§': 'ÂøôÁ¢å', 'ÂÆ∂': 'ËàíÈÄÇ', 'ÂåªÈô¢': '‰∏•ËÇÉ',
                    'È§êÂéÖ': 'ÊÑâÂø´', '‰øÆÁêÜÂ∫ó': '‰∏ìÊ≥®'
                };
                agent.mood = moodEffects[building.name] || 'Âπ≥Èùô';
            });
            
            generateMap();
            generateAgentCards();
            showNotification('ÊâÄÊúâAgentÂ∑≤ÈöèÊú∫ÁßªÂä®', 'success');
        }

        // ÈáçÁΩÆAgent‰ΩçÁΩÆ
        function resetAgents() {
            const initialPositions = {
                'Alex': {location: 'ÂäûÂÖ¨ÂÆ§', x: 5, y: 1},
                'Emma': {location: 'ÂÖ¨Âõ≠', x: 2, y: 1},
                'Sarah': {location: 'Âõæ‰π¶È¶Ü', x: 4, y: 3},
                'David': {location: 'ÂäûÂÖ¨ÂÆ§', x: 5, y: 1},
                'Lisa': {location: 'Âõæ‰π¶È¶Ü', x: 4, y: 3},
                'Mike': {location: 'ÂÖ¨Âõ≠', x: 2, y: 1},
                'John': {location: 'ÂåªÈô¢', x: 0, y: 2},
                'Anna': {location: 'È§êÂéÖ', x: 5, y: 4},
                'Tom': {location: '‰øÆÁêÜÂ∫ó', x: 1, y: 0}
            };
            
            Object.entries(initialPositions).forEach(([name, pos]) => {
                if (gameData.agents[name]) {
                    gameData.agents[name].x = pos.x;
                    gameData.agents[name].y = pos.y;
                    gameData.agents[name].location = pos.location;
                }
            });
            
            generateMap();
            generateAgentCards();
            showNotification('ÊâÄÊúâAgentÂ∑≤ÂõûÂà∞ÂàùÂßã‰ΩçÁΩÆ', 'success');
        }

        // Âà∑Êñ∞Âú∞Âõæ
        function refreshMap() {
            generateMap();
            showNotification('Âú∞ÂõæÂ∑≤Âà∑Êñ∞', 'success');
        }

        // Ê®°Êãü‰∏ÄÊ≠• - Â¢ûÂº∫ÁâàÔºåËÄÉËôëagentÂÖ≥Á≥ªÂíå‰∫§‰∫í
        function simulateStep() {
            const events = [];
            const agentNames = Object.keys(gameData.agents);
            const activeAgents = agentNames.sort(() => 0.5 - Math.random()).slice(0, Math.min(4, agentNames.length));
            
            activeAgents.forEach(agentName => {
                const agent = gameData.agents[agentName];
                
                // Âü∫‰∫éÂΩìÂâçÁä∂ÊÄÅÂíåÂÖ≥Á≥ªÁöÑË°å‰∏∫
                const actions = [
                    `Âú®${agent.location}${agent.mood}Âú∞Â∑•‰Ωú`,
                    `ËßÇÂØü${agent.location}ÁöÑÁéØÂ¢ÉÔºåÊÄùËÄÉ‰∫∫Áîü`,
                    `ÂÜ≥ÂÆöÂÅö‰∏Ä‰∫õÊúâË∂£ÁöÑ‰∫ãÊÉÖ`,
                    `ÊÑüÂà∞${agent.energy > 70 ? 'Á≤æÂäõÂÖÖÊ≤õ' : 'Êúâ‰∫õÁñ≤ÊÉ´'}`,
                    `ÂõûÂøÜËµ∑‰∏éÊúãÂèã‰ª¨ÁöÑÁæéÂ•ΩÊó∂ÂÖâ`,
                    `ËÆ°Âàí‰∏ãÊ¨°‰∏éÂêå‰∫ãËÅö‰ºö`,
                    `‰∫´ÂèóÂΩìÂâçÁöÑ${agent.mood}Áä∂ÊÄÅ`
                ];
                
                const action = actions[Math.floor(Math.random() * actions.length)];
                events.push(`${agent.emoji} ${agentName}: ${action}`);
                
                // Êõ¥Êñ∞AgentÁä∂ÊÄÅ
                agent.energy = Math.max(10, Math.min(100, agent.energy + Math.floor(Math.random() * 21) - 10));
                
                // Êô∫ËÉΩÁßªÂä®ÔºöËÄÉËôëÂÖ≥Á≥ªÂíåÂÅèÂ•Ω
                if (Math.random() < 0.3) {
                    let targetLocation = null;
                    
                    // ÊúâÊó∂‰ºöË∑üÈöèÂÖ≥Á≥ªÂ•ΩÁöÑagent
                    if (Math.random() < 0.4 && agent.relationships) {
                        const bestFriends = Object.entries(agent.relationships)
                            .filter(([_, rel]) => rel.strength > 0.6)
                            .sort((a, b) => b[1].strength - a[1].strength);
                        
                        if (bestFriends.length > 0) {
                            const friendName = bestFriends[0][0];
                            const friendLocation = gameData.agents[friendName].location;
                            targetLocation = friendLocation;
                            events.push(`üíù ${agentName} ÊÉ≥ÂéªÊâæÂ•ΩÂèã ${friendName}ÔºåÂâçÂæÄ ${friendLocation}`);
                        }
                    }
                    
                    // Âê¶ÂàôÈöèÊú∫ÁßªÂä®
                    if (!targetLocation) {
                        const newBuilding = gameData.buildings[Math.floor(Math.random() * gameData.buildings.length)];
                        targetLocation = newBuilding.name;
                        const oldLocation = agent.location;
                        events.push(`üö∂ ${agentName} ‰ªé ${oldLocation} ÁßªÂä®Âà∞ ${newBuilding.name}`);
                    }
                    
                    // ÊâßË°åÁßªÂä®
                    const building = gameData.buildings.find(b => b.name === targetLocation);
                    if (building) {
                        agent.x = building.x;
                        agent.y = building.y;
                        agent.location = building.name;
                        
                        // Êõ¥Êñ∞Âú∞ÁÇπÁÉ≠Â∫¶
                        if (gameData.locationPopularity[targetLocation]) {
                            gameData.locationPopularity[targetLocation].visits = 
                                (gameData.locationPopularity[targetLocation].visits || 0) + 1;
                            gameData.locationPopularity[targetLocation].popularityScore += 0.05;
                        }
                    }
                }
                
                // Êõ¥Êñ∞ÂøÉÊÉÖÂü∫‰∫éÁéØÂ¢ÉÂíåÂÖ≥Á≥ª
                if (Math.random() < 0.2) {
                    const locationMoods = {
                        'ÂíñÂï°ÂéÖ': ['ÊîæÊùæ', 'ÊÉ¨ÊÑè', 'Á§æ‰∫§'],
                        'Âõæ‰π¶È¶Ü': ['‰∏ìÊ≥®', 'Â≠¶‰π†', 'ÂÆâÈùô'],
                        'ÂÖ¨Âõ≠': ['ÂºÄÂøÉ', 'Ê¥ªÂäõ', 'Ëá™Áî±'],
                        'ÂäûÂÖ¨ÂÆ§': ['ÂøôÁ¢å', '‰∏ì‰∏ö', 'ÊïàÁéá'],
                        'ÂÆ∂': ['ËàíÈÄÇ', 'ÂÆâÂÖ®', 'Ê∏©Êöñ'],
                        'ÂåªÈô¢': ['‰∏•ËÇÉ', 'ÂÖ≥ÊÄÄ', '‰∏ì‰∏ö'],
                        'È§êÂéÖ': ['ÊÑâÂø´', 'Êª°Ë∂≥', '‰∫´Âèó'],
                        '‰øÆÁêÜÂ∫ó': ['‰∏ìÊ≥®', 'ÂÆûÁî®', 'ÊàêÂ∞±ÊÑü']
                    };
                    
                    const possibleMoods = locationMoods[agent.location] || ['Âπ≥Èùô', 'ÊÄùËÄÉ', 'ËßÇÂØü'];
                    agent.mood = possibleMoods[Math.floor(Math.random() * possibleMoods.length)];
                }
            });
            
            // Ê£ÄÊü•ÂêåÂú∞ÁÇπÁöÑagentsÔºåÂèØËÉΩËß¶Âèë‰∫§‰∫í
            const locationGroups = {};
            agentNames.forEach(name => {
                const agent = gameData.agents[name];
                const key = `${agent.x},${agent.y}`;
                if (!locationGroups[key]) {
                    locationGroups[key] = [];
                }
                locationGroups[key].push(name);
            });
            
            // Â¶ÇÊûúÊúâÂ§ö‰∏™agentÂú®Âêå‰∏Ä‰ΩçÁΩÆÔºåÂèØËÉΩ‰ºö‰∫§‰∫í
            Object.values(locationGroups).forEach(group => {
                if (group.length >= 2 && Math.random() < 0.3) { // 30%Ê¶ÇÁéá‰∫§‰∫í
                    const location = gameData.agents[group[0]].location;
                    events.push(`üë• ${group.join(', ')} Âú®${location}Áõ∏ÈÅá‰∫ÜÔºÅ`);
                    
                    // Â¶ÇÊûúËá™Âä®‰∫§‰∫íÂºÄÂêØÔºåËß¶ÂèëÁúüÂÆû‰∫§‰∫í
                    if (gameData.autoInteraction && Math.random() < 0.5) {
                        setTimeout(() => {
                            executeAgentInteraction(group.slice(0, 3)); // ÊúÄÂ§ö3‰∏™agent‰∫§‰∫í
                        }, 1000);
                    }
                }
            });
            
            // ÊòæÁ§∫Ê®°ÊãüÁªìÊûú
            const outputDiv = document.getElementById('simulationOutput');
            outputDiv.innerHTML = `
                <div style="color: var(--primary); font-weight: 600; margin-bottom: 10px;">
                    <i class="fas fa-clock"></i> Ê®°ÊãüÊó∂Èó¥: ${new Date().toLocaleTimeString()}
                </div>
                ${events.map(event => `<div style="margin: 5px 0; padding: 5px 0; border-left: 3px solid var(--accent); padding-left: 10px;">${event}</div>`).join('')}
            `;
            
            // Âà∑Êñ∞ÊòæÁ§∫
            generateMap();
            generateAgentCards();
            showNotification(`Êô∫ËÉΩÊ®°ÊãüÂÆåÊàêÔºå${activeAgents.length}‰∏™AgentÊâßË°å‰∫ÜÂä®‰Ωú`, 'success');
        }

        // ÈîÆÁõò‰∫ã‰ª∂
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && document.getElementById('messageInput') === document.activeElement) {
                sendMessage();
            }
            if (e.key === 'Escape') {
                clearChat();
            }
        });

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            initParticles();
            loadGameData(); // Âä†ËΩΩ‰øùÂ≠òÁöÑÊï∞ÊçÆ
            initializeSocialNetwork(); // ÂàùÂßãÂåñÁ§æ‰∫§ÁΩëÁªú
            generateMap();
            generateAgentCards();
            
            // Ê∑ªÂä†ËæìÂÖ•Ê°Ü‰∫ã‰ª∂ÁõëÂê¨
            document.getElementById('messageInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            showNotification('AIËôöÊãüÂ∞èÈïáÂ∑≤ÂêØÂä®ÔºÅÁ§æ‰∫§ÁΩëÁªúÂ∑≤ÂàùÂßãÂåñ', 'success');
            
            // ÂÆöÊúüËá™Âä®Ê®°ÊãüÂíå‰∫§‰∫í
            setInterval(() => {
                if (Math.random() < 0.1) { // 10%Ê¶ÇÁéáËá™Âä®Ê®°Êãü
                    simulateStep();
                }
                
                // Ëá™Âä®agent‰∫§‰∫í
                if (gameData.autoInteraction && Math.random() < 0.15) { // 15%Ê¶ÇÁéáËá™Âä®‰∫§‰∫í
                    triggerAgentInteraction();
                }
                
                // Êô∫ËÉΩÁßªÂä®
                if (Math.random() < 0.2) { // 20%Ê¶ÇÁéáÊô∫ËÉΩÁßªÂä®
                    intelligentGroupMovement();
                    generateMap();
                    generateAgentCards();
                }
                
                // ÂÖ≥Á≥ªË°∞Âáè
                applyRelationshipDecay();
                
                // Ëá™Âä®‰øùÂ≠òÊï∞ÊçÆ
                saveGameData();
                
            }, 20000); // ÊØè20ÁßíÊ£ÄÊü•‰∏ÄÊ¨°
            
            // ÂÆöÊúüÊõ¥Êñ∞Âú∞ÁÇπÁÉ≠Â∫¶
            setInterval(() => {
                Object.entries(gameData.locationPopularity).forEach(([location, stats]) => {
                    const currentCount = Object.values(gameData.agents).filter(agent => agent.location === location).length;
                    gameData.locationPopularity[location].currentOccupants = currentCount;
                    gameData.locationPopularity[location].popularityScore = 
                        Math.max(0, stats.popularityScore - 0.01); // ÁÉ≠Â∫¶ÁºìÊÖ¢Ë°∞Âáè
                });
            }, 10000); // ÊØè10ÁßíÊõ¥Êñ∞ÁÉ≠Â∫¶
            
            // ÂÆöÊúü‰øùÂ≠òÊï∞ÊçÆ
            setInterval(() => {
                saveGameData();
            }, 60000); // ÊØèÂàÜÈíü‰øùÂ≠ò‰∏ÄÊ¨°
        });

        // Êï∞ÊçÆÊåÅ‰πÖÂåñÁ≥ªÁªü
        function saveGameData() {
            try {
                const dataToSave = {
                    agents: gameData.agents,
                    socialNetwork: gameData.socialNetwork,
                    locationPopularity: gameData.locationPopularity,
                    agentInteractions: gameData.agentInteractions.slice(-100), // Âè™‰øùÂ≠òÊúÄËøë100Êù°
                    chatHistory: gameData.chatHistory.slice(-50), // Âè™‰øùÂ≠òÊúÄËøë50Êù°
                    systemTime: gameData.systemTime,
                    lastDecayTime: gameData.lastDecayTime
                };
                
                localStorage.setItem('aiTownData', JSON.stringify(dataToSave));
                console.log('Ê∏∏ÊàèÊï∞ÊçÆÂ∑≤‰øùÂ≠ò');
            } catch (error) {
                console.error('‰øùÂ≠òÊï∞ÊçÆÂ§±Ë¥•:', error);
            }
        }

        function loadGameData() {
            try {
                const savedData = localStorage.getItem('aiTownData');
                if (savedData) {
                    const loadedData = JSON.parse(savedData);
                    
                    // ÊÅ¢Â§çÊï∞ÊçÆ
                    if (loadedData.agents) {
                        Object.assign(gameData.agents, loadedData.agents);
                    }
                    if (loadedData.socialNetwork) {
                        Object.assign(gameData.socialNetwork, loadedData.socialNetwork);
                    }
                    if (loadedData.locationPopularity) {
                        Object.assign(gameData.locationPopularity, loadedData.locationPopularity);
                    }
                    if (loadedData.agentInteractions) {
                        gameData.agentInteractions = loadedData.agentInteractions;
                    }
                    if (loadedData.chatHistory) {
                        gameData.chatHistory = loadedData.chatHistory;
                    }
                    if (loadedData.systemTime) {
                        gameData.systemTime = new Date(loadedData.systemTime);
                    }
                    if (loadedData.lastDecayTime) {
                        gameData.lastDecayTime = new Date(loadedData.lastDecayTime);
                    }
                    
                    console.log('Ê∏∏ÊàèÊï∞ÊçÆÂ∑≤Âä†ËΩΩ');
                    showNotification('Ê∏∏ÊàèÊï∞ÊçÆÂ∑≤ÊÅ¢Â§ç', 'success');
                }
            } catch (error) {
                console.error('Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•:', error);
            }
        }

        // È´òÁ∫ßÁªüËÆ°Á≥ªÁªü
        function getAdvancedStats() {
            const stats = {
                agents: {
                    total: Object.keys(gameData.agents).length,
                    byOccupation: {},
                    byLocation: {},
                    byMood: {},
                    avgEnergy: 0,
                    totalMemories: 0
                },
                relationships: {
                    total: 0,
                    byLevel: {},
                    avgStrength: 0,
                    totalInteractions: 0
                },
                locations: {
                    total: Object.keys(gameData.buildings).length,
                    byPopularity: [],
                    totalVisits: 0,
                    totalInteractions: 0
                },
                interactions: {
                    total: gameData.agentInteractions.length,
                    byType: {},
                    byLocation: {},
                    recent: gameData.agentInteractions.slice(-10)
                }
            };
            
            // AgentÁªüËÆ°
            let totalEnergy = 0;
            Object.values(gameData.agents).forEach(agent => {
                // ËÅå‰∏öÁªüËÆ°
                stats.agents.byOccupation[agent.occupation] = 
                    (stats.agents.byOccupation[agent.occupation] || 0) + 1;
                
                // ‰ΩçÁΩÆÁªüËÆ°
                stats.agents.byLocation[agent.location] = 
                    (stats.agents.byLocation[agent.location] || 0) + 1;
                
                // ÂøÉÊÉÖÁªüËÆ°
                stats.agents.byMood[agent.mood] = 
                    (stats.agents.byMood[agent.mood] || 0) + 1;
                
                totalEnergy += agent.energy;
                stats.agents.totalMemories += agent.memories.length;
            });
            stats.agents.avgEnergy = totalEnergy / stats.agents.total;
            
            // ÂÖ≥Á≥ªÁªüËÆ°
            let totalStrength = 0;
            Object.values(gameData.agents).forEach(agent => {
                Object.values(agent.relationships).forEach(relationship => {
                    stats.relationships.total++;
                    stats.relationships.totalInteractions += relationship.interactions;
                    totalStrength += relationship.strength;
                    
                    stats.relationships.byLevel[relationship.relationshipLevel] = 
                        (stats.relationships.byLevel[relationship.relationshipLevel] || 0) + 1;
                });
            });
            stats.relationships.avgStrength = totalStrength / stats.relationships.total;
            
            // Âú∞ÁÇπÁªüËÆ°
            let totalVisits = 0;
            let totalLocationInteractions = 0;
            Object.entries(gameData.locationPopularity).forEach(([location, data]) => {
                totalVisits += data.visits || 0;
                totalLocationInteractions += data.interactions || 0;
                
                stats.locations.byPopularity.push({
                    location: location,
                    popularity: data.popularityScore,
                    visits: data.visits,
                    interactions: data.interactions,
                    currentOccupants: data.currentOccupants
                });
            });
            stats.locations.totalVisits = totalVisits;
            stats.locations.totalInteractions = totalLocationInteractions;
            
            // ‰∫§‰∫íÁªüËÆ°
            gameData.agentInteractions.forEach(interaction => {
                stats.interactions.byType[interaction.type] = 
                    (stats.interactions.byType[interaction.type] || 0) + 1;
                stats.interactions.byLocation[interaction.location] = 
                    (stats.interactions.byLocation[interaction.location] || 0) + 1;
            });
            
            // ÊéíÂ∫è
            stats.locations.byPopularity.sort((a, b) => b.popularity - a.popularity);
            
            return stats;
        }

        // ÊòæÁ§∫È´òÁ∫ßÁªüËÆ°
        function showAdvancedStats() {
            const stats = getAdvancedStats();
            let statsText = "üìä È´òÁ∫ßÁªüËÆ°ÂàÜÊûê\n\n";
            
            // AgentÁªüËÆ°
            statsText += "üë• AgentÁªüËÆ°:\n";
            statsText += `  ÊÄªÊï∞Èáè: ${stats.agents.total}\n`;
            statsText += `  Âπ≥ÂùáËÉΩÈáè: ${stats.agents.avgEnergy.toFixed(1)}%\n`;
            statsText += `  ÊÄªËÆ∞ÂøÜÊï∞: ${stats.agents.totalMemories}\n\n`;
            
            statsText += "üíº ËÅå‰∏öÂàÜÂ∏É:\n";
            Object.entries(stats.agents.byOccupation).forEach(([occupation, count]) => {
                statsText += `  ${occupation}: ${count} ‰∫∫\n`;
            });
            statsText += "\n";
            
            // ÂÖ≥Á≥ªÁªüËÆ°
            statsText += "‚ù§Ô∏è ÂÖ≥Á≥ªÁªüËÆ°:\n";
            statsText += `  ÊÄªÂÖ≥Á≥ªÊï∞: ${stats.relationships.total}\n`;
            statsText += `  Âπ≥ÂùáÂº∫Â∫¶: ${(stats.relationships.avgStrength * 100).toFixed(1)}%\n`;
            statsText += `  ÊÄª‰∫§‰∫íÊï∞: ${stats.relationships.totalInteractions}\n\n`;
            
            statsText += "üìà ÂÖ≥Á≥ªÁ≠âÁ∫ßÂàÜÂ∏É:\n";
            Object.entries(stats.relationships.byLevel).forEach(([level, count]) => {
                statsText += `  ${level}: ${count} ‰∏™\n`;
            });
            statsText += "\n";
            
            // Âú∞ÁÇπÁªüËÆ°
            statsText += "üìç Âú∞ÁÇπÁªüËÆ°:\n";
            statsText += `  ÊÄªÂú∞ÁÇπÊï∞: ${stats.locations.total}\n`;
            statsText += `  ÊÄªËÆøÈóÆÊï∞: ${stats.locations.totalVisits}\n`;
            statsText += `  ÊÄª‰∫§‰∫íÊï∞: ${stats.locations.totalInteractions}\n\n`;
            
            statsText += "üî• ÁÉ≠Èó®Âú∞ÁÇπÊéíË°å:\n";
            stats.locations.byPopularity.slice(0, 5).forEach((loc, index) => {
                statsText += `  ${loc.location}: ${loc.popularity.toFixed(1)}ÂàÜ\n`;
            });
            statsText += "\n";
            
            // ‰∫§‰∫íÁªüËÆ°
            statsText += "üí¨ ‰∫§‰∫íÁªüËÆ°:\n";
            statsText += `  ÊÄª‰∫§‰∫íÊï∞: ${stats.interactions.total}\n\n`;
            
            statsText += "üéØ ‰∫§‰∫íÁ±ªÂûãÂàÜÂ∏É:\n";
            Object.entries(stats.interactions.byType).forEach(([type, count]) => {
                statsText += `  ${type}: ${count} Ê¨°\n`;
            });
            
            alert(statsText);
        }

        // Êô∫ËÉΩÁßªÂä®Á≥ªÁªü
        function intelligentAgentMovement(agentName) {
            const agent = gameData.agents[agentName];
            const currentLocation = agent.location;
            
            // ÁßªÂä®Ê¶ÇÁéáÔºö30%Ê¶ÇÁéáÁßªÂä®
            if (Math.random() > 0.3) {
                return null;
            }
            
            let targetLocation = null;
            let moveReason = '';
            
            // Á≠ñÁï•1ÔºöË∑üÈöèÂÖ≥Á≥ªÂ•ΩÁöÑÊúãÂèã
            if (Math.random() < 0.4 && agent.relationships) {
                const bestFriends = Object.entries(agent.relationships)
                    .filter(([_, rel]) => rel.strength > 0.6)
                    .sort((a, b) => b[1].strength - a[1].strength);
                
                if (bestFriends.length > 0) {
                    const friendName = bestFriends[0][0];
                    const friendLocation = gameData.agents[friendName].location;
                    
                    if (friendLocation !== currentLocation) {
                        targetLocation = friendLocation;
                        moveReason = `ÊÉ≥ÂéªÊâæÂ•ΩÂèã ${friendName}`;
                    }
                }
            }
            
            // Á≠ñÁï•2ÔºöÂü∫‰∫éËÅå‰∏öÂÅèÂ•Ω
            if (!targetLocation && Math.random() < 0.3) {
                const preferredLocations = agent.preferences.filter(loc => loc !== currentLocation);
                if (preferredLocations.length > 0) {
                    targetLocation = preferredLocations[Math.floor(Math.random() * preferredLocations.length)];
                    moveReason = `ËÅå‰∏öÂÅèÂ•Ω`;
                }
            }
            
            // Á≠ñÁï•3ÔºöÊé¢Á¥¢Êñ∞Âú∞ÁÇπ
            if (!targetLocation && Math.random() < 0.2) {
                const unvisitedLocations = Object.keys(gameData.buildings).filter(loc => 
                    loc !== currentLocation && !agent.memories.some(m => m.location === loc)
                );
                
                if (unvisitedLocations.length > 0) {
                    targetLocation = unvisitedLocations[Math.floor(Math.random() * unvisitedLocations.length)];
                    moveReason = `Êé¢Á¥¢Êñ∞Âú∞ÁÇπ`;
                }
            }
            
            // Á≠ñÁï•4ÔºöÈöèÊú∫ÁßªÂä®
            if (!targetLocation) {
                const allLocations = Object.keys(gameData.buildings);
                const otherLocations = allLocations.filter(loc => loc !== currentLocation);
                targetLocation = otherLocations[Math.floor(Math.random() * otherLocations.length)];
                moveReason = `ÈöèÊú∫ÁßªÂä®`;
            }
            
            // ÊâßË°åÁßªÂä®
            if (targetLocation && targetLocation !== currentLocation) {
                const building = gameData.buildings.find(b => b.name === targetLocation);
                if (building) {
                    const oldLocation = agent.location;
                    agent.x = building.x;
                    agent.y = building.y;
                    agent.location = targetLocation;
                    
                    // Êõ¥Êñ∞Âú∞ÁÇπÁÉ≠Â∫¶
                    if (gameData.locationPopularity[targetLocation]) {
                        gameData.locationPopularity[targetLocation].visits = 
                            (gameData.locationPopularity[targetLocation].visits || 0) + 1;
                        gameData.locationPopularity[targetLocation].popularityScore += 0.05;
                        gameData.locationPopularity[targetLocation].lastActivity = new Date();
                    }
                    
                    // ËÆ∞ÂΩïÁßªÂä®ËÆ∞ÂøÜ
                    agent.memories.push({
                        type: 'movement',
                        from: oldLocation,
                        to: targetLocation,
                        reason: moveReason,
                        timestamp: new Date().toISOString()
                    });
                    
                    // ÈôêÂà∂ËÆ∞ÂøÜÊï∞Èáè
                    if (agent.memories.length > 50) {
                        agent.memories = agent.memories.slice(-50);
                    }
                    
                    // Êõ¥Êñ∞ÂøÉÊÉÖÂü∫‰∫éÊñ∞Âú∞ÁÇπ
                    updateAgentMood(agentName, targetLocation);
                    
                    return {
                        from: oldLocation,
                        to: targetLocation,
                        reason: moveReason
                    };
                }
            }
            
            return null;
        }

        // Êõ¥Êñ∞AgentÂøÉÊÉÖ
        function updateAgentMood(agentName, location) {
            const agent = gameData.agents[agentName];
            
            const locationMoods = {
                'ÂíñÂï°ÂéÖ': ['ÊîæÊùæ', 'ÊÉ¨ÊÑè', 'Á§æ‰∫§', 'ÊÄùËÄÉ'],
                'Âõæ‰π¶È¶Ü': ['‰∏ìÊ≥®', 'Â≠¶‰π†', 'ÂÆâÈùô', 'Ê±ÇÁü•'],
                'ÂÖ¨Âõ≠': ['ÂºÄÂøÉ', 'Ê¥ªÂäõ', 'Ëá™Áî±', 'ÊîæÊùæ'],
                'ÂäûÂÖ¨ÂÆ§': ['ÂøôÁ¢å', '‰∏ì‰∏ö', 'ÊïàÁéá', '‰∏ìÊ≥®'],
                'ÂÆ∂': ['ËàíÈÄÇ', 'ÂÆâÂÖ®', 'Ê∏©Êöñ', 'ÊîæÊùæ'],
                'ÂåªÈô¢': ['‰∏•ËÇÉ', 'ÂÖ≥ÊÄÄ', '‰∏ì‰∏ö', '‰∏ìÊ≥®'],
                'È§êÂéÖ': ['ÊÑâÂø´', 'Êª°Ë∂≥', '‰∫´Âèó', 'Á§æ‰∫§'],
                '‰øÆÁêÜÂ∫ó': ['‰∏ìÊ≥®', 'ÂÆûÁî®', 'ÊàêÂ∞±ÊÑü', 'ÂøôÁ¢å']
            };
            
            const possibleMoods = locationMoods[location] || ['Âπ≥Èùô', 'ÊÄùËÄÉ', 'ËßÇÂØü'];
            const newMood = possibleMoods[Math.floor(Math.random() * possibleMoods.length)];
            
            // 70%Ê¶ÇÁéáÊîπÂèòÂøÉÊÉÖ
            if (Math.random() < 0.7) {
                agent.mood = newMood;
            }
            
            // ËÉΩÈáèÂèòÂåñ
            const energyChange = Math.floor(Math.random() * 11) - 5; // -5 Âà∞ +5
            agent.energy = Math.max(10, Math.min(100, agent.energy + energyChange));
        }

        // Êô∫ËÉΩÁæ§‰ΩìÁßªÂä®
        function intelligentGroupMovement() {
            const agentNames = Object.keys(gameData.agents);
            const movedAgents = [];
            
            agentNames.forEach(agentName => {
                const movement = intelligentAgentMovement(agentName);
                if (movement) {
                    movedAgents.push({
                        agent: agentName,
                        ...movement
                    });
                }
            });
            
            return movedAgents;
        }

        // Âü∫‰∫éÂÖ≥Á≥ªÁöÑÊé®ËçêÁßªÂä®
        function getRecommendedLocations(agentName) {
            const agent = gameData.agents[agentName];
            const recommendations = [];
            
            // Âü∫‰∫éÊúãÂèã‰ΩçÁΩÆÊé®Ëçê
            Object.entries(agent.relationships).forEach(([friendName, relationship]) => {
                if (relationship.strength > 0.5) {
                    const friendLocation = gameData.agents[friendName].location;
                    if (friendLocation !== agent.location) {
                        recommendations.push({
                            location: friendLocation,
                            reason: `Â•ΩÂèã ${friendName} Âú®Ê≠§`,
                            priority: relationship.strength
                        });
                    }
                }
            });
            
            // Âü∫‰∫éËÅå‰∏öÂÅèÂ•ΩÊé®Ëçê
            agent.preferences.forEach(pref => {
                if (pref !== agent.location) {
                    recommendations.push({
                        location: pref,
                        reason: 'ËÅå‰∏öÂÅèÂ•Ω',
                        priority: 0.6
                    });
                }
            });
            
            // Âü∫‰∫éÂú∞ÁÇπÁÉ≠Â∫¶Êé®Ëçê
            Object.entries(gameData.locationPopularity).forEach(([location, stats]) => {
                if (location !== agent.location && stats.popularityScore > 60) {
                    recommendations.push({
                        location: location,
                        reason: 'ÁÉ≠Èó®Âú∞ÁÇπ',
                        priority: stats.popularityScore / 100
                    });
                }
            });
            
            // Êåâ‰ºòÂÖàÁ∫ßÊéíÂ∫è
            return recommendations.sort((a, b) => b.priority - a.priority);
        }

        // Êï∞ÊçÆÂØºÂá∫ÂäüËÉΩ
        function exportGameData() {
            try {
                const exportData = {
                    exportTime: new Date().toISOString(),
                    version: '3.0',
                    agents: gameData.agents,
                    socialNetwork: gameData.socialNetwork,
                    locationPopularity: gameData.locationPopularity,
                    agentInteractions: gameData.agentInteractions,
                    chatHistory: gameData.chatHistory,
                    systemTime: gameData.systemTime,
                    lastDecayTime: gameData.lastDecayTime
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `ai_town_data_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                showNotification('Ê∏∏ÊàèÊï∞ÊçÆÂ∑≤ÂØºÂá∫', 'success');
            } catch (error) {
                console.error('ÂØºÂá∫Êï∞ÊçÆÂ§±Ë¥•:', error);
                showNotification('ÂØºÂá∫Êï∞ÊçÆÂ§±Ë¥•', 'error');
            }
        }

        // ÈáçÁΩÆÊ∏∏ÊàèÊï∞ÊçÆ
        function resetGameData() {
            if (confirm('Á°ÆÂÆöË¶ÅÈáçÁΩÆÊâÄÊúâÊ∏∏ÊàèÊï∞ÊçÆÂêóÔºüËøôÂ∞ÜÊ∏ÖÈô§ÊâÄÊúâAgentÂÖ≥Á≥ª„ÄÅ‰∫§‰∫íÂéÜÂè≤ÂíåËÅäÂ§©ËÆ∞ÂΩï„ÄÇ')) {
                try {
                    // Ê∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®
                    localStorage.removeItem('aiTownData');
                    
                    // ÈáçÁΩÆÊ∏∏ÊàèÊï∞ÊçÆ
                    gameData.agentInteractions = [];
                    gameData.chatHistory = [];
                    gameData.systemTime = new Date();
                    gameData.lastDecayTime = new Date();
                    
                    // ÈáçÊñ∞ÂàùÂßãÂåñÁ§æ‰∫§ÁΩëÁªú
                    initializeSocialNetwork();
                    
                    // ÈáçÁΩÆAgent‰ΩçÁΩÆ
                    resetAgents();
                    
                    // Ê∏ÖÁ©∫‰∫§‰∫íÂéÜÂè≤ÊòæÁ§∫
                    clearInteractionHistory();
                    
                    // Ê∏ÖÁ©∫ËÅäÂ§©ËÆ∞ÂΩï
                    clearChat();
                    
                    // Âà∑Êñ∞ÊòæÁ§∫
                    generateMap();
                    generateAgentCards();
                    
                    showNotification('Ê∏∏ÊàèÊï∞ÊçÆÂ∑≤ÈáçÁΩÆ', 'success');
                } catch (error) {
                    console.error('ÈáçÁΩÆÊï∞ÊçÆÂ§±Ë¥•:', error);
                    showNotification('ÈáçÁΩÆÊï∞ÊçÆÂ§±Ë¥•', 'error');
                }
            }
        }

        // ÊòæÁ§∫ÂÖ≥Á≥ªË°∞Âáè‰ø°ÊÅØ
        function showDecayInfo() {
            const now = new Date();
            const timeDiff = now - gameData.lastDecayTime;
            const minutesSinceDecay = Math.floor(timeDiff / (1000 * 60));
            
            let decayText = `üìä ÂÖ≥Á≥ªË°∞Âáè‰ø°ÊÅØ\n\n`;
            decayText += `‰∏äÊ¨°Ë°∞ÂáèÊó∂Èó¥: ${gameData.lastDecayTime.toLocaleString()}\n`;
            decayText += `Ë∑ùÁ¶ª‰∏ãÊ¨°Ë°∞Âáè: ${Math.max(0, 30 - minutesSinceDecay)} ÂàÜÈíü\n`;
            decayText += `Ë°∞ÂáèÈó¥Èöî: 30 ÂàÜÈíü\n\n`;
            
            // ÁªüËÆ°ÂÖ≥Á≥ªÂèòÂåñ
            let strongRelationships = 0;
            let weakRelationships = 0;
            let totalRelationships = 0;
            
            Object.values(gameData.agents).forEach(agent => {
                Object.values(agent.relationships).forEach(relationship => {
                    totalRelationships++;
                    if (relationship.strength > 0.6) {
                        strongRelationships++;
                    } else if (relationship.strength < 0.3) {
                        weakRelationships++;
                    }
                });
            });
            
            decayText += `ÂÖ≥Á≥ªÁªüËÆ°:\n`;
            decayText += `  ÊÄªÂÖ≥Á≥ªÊï∞: ${totalRelationships}\n`;
            decayText += `  Âº∫ÂÖ≥Á≥ª (>60%): ${strongRelationships}\n`;
            decayText += `  Âº±ÂÖ≥Á≥ª (<30%): ${weakRelationships}\n`;
            decayText += `  ‰∏≠Á≠âÂÖ≥Á≥ª: ${totalRelationships - strongRelationships - weakRelationships}\n`;
            
            alert(decayText);
        }
    </script>
</body>
</html>
