"""
å…³ç³»ç³»ç»Ÿé…ç½®æ–‡ä»¶
å®šä¹‰Agentä¹‹é—´å…³ç³»çš„è¯¦ç»†è§„åˆ™å’Œé˜ˆå€¼
"""

# å…³ç³»ç­‰çº§é…ç½®
RELATIONSHIP_LEVELS = {
    "æ•Œå¯¹": {"min": -20, "max": -1, "emoji": "ğŸ˜ ", "description": "å…³ç³»å¾ˆå·®ï¼Œç»å¸¸å†²çª"},
    "é™Œç”Ÿ": {"min": 0, "max": 20, "emoji": "ï¿½", "description": "ä¸ç†Ÿæ‚‰ï¼Œåˆæ¬¡è§é¢"},
    "è®¤è¯†": {"min": 21, "max": 40, "emoji": "ğŸ™‚", "description": "æœ‰è¿‡å‡ æ¬¡äº¤æµï¼Œç®—æ˜¯è®¤è¯†"},
    "ç†Ÿäºº": {"min": 41, "max": 60, "emoji": "ğŸ˜Š", "description": "æ¯”è¾ƒç†Ÿæ‚‰ï¼Œå¶å°”èŠå¤©"},
    "å¥½æœ‹å‹": {"min": 61, "max": 80, "emoji": "ğŸ˜„", "description": "å…³ç³»å¾ˆå¥½ï¼Œç»å¸¸äº¤æµ"},
    "äº²å¯†æœ‹å‹": {"min": 81, "max": 100, "emoji": "ğŸ¥°", "description": "éå¸¸äº²å¯†ï¼Œæ— è¯ä¸è°ˆ"}
}

# äº’åŠ¨ç±»å‹å’Œå¯¹åº”çš„å…³ç³»å˜åŒ–å€¼
INTERACTION_EFFECTS = {
    "friendly_chat": {
        "change": 3,  # å‹å¥½èŠå¤©åŸºç¡€åˆ†æ•°
        "description": "å‹å¥½èŠå¤©",
        "conditions": {
            "åŒåœ°ç‚¹": +2,  # åœ¨åŒä¸€åœ°ç‚¹èŠå¤©é¢å¤–åŠ åˆ†
            "ç›¸åŒèŒä¸š": +2,  # ç›¸åŒèŒä¸šæœ‰å…±åŒè¯é¢˜
            "é¦–æ¬¡äº¤æµ": +5,  # é¦–æ¬¡äº¤æµåŠ åˆ†ï¼Œä»é™Œç”Ÿåˆ°è®¤è¯†
        }
    },
    "disagreement": {
        "change": -6,  # è½»åº¦ä¸åŒæ„è§
        "description": "æ„è§ä¸åˆ",
        "conditions": {
            "ä¸åŒè§‚ç‚¹": -3,  # è§‚ç‚¹ä¸åŒ
            "ä»·å€¼è§‚å·®å¼‚": -2,  # ä»·å€¼è§‚å·®å¼‚
            "æ€åº¦å¼ºç¡¬": -2,   # æ€åº¦æ¯”è¾ƒå¼ºç¡¬
        }
    },
    "argument": {
        "change": -12,  # ä»-8å¢åŠ åˆ°-12ï¼Œç¡®ä¿äº‰åµæ‰£åˆ†æ˜æ˜¾
        "description": "å‘ç”Ÿäº‰åµ",
        "conditions": {
            "ä»·å€¼è§‚å†²çª": -6,  # ä»-4å¢åŠ åˆ°-6
            "å·¥ä½œå‹åŠ›": -5,   # ä»-3å¢åŠ åˆ°-5
            "å…¬å…±åœºæ‰€": -5,   # ä»-3å¢åŠ åˆ°-5ï¼Œå…¬å¼€äº‰åµæ›´ä¼¤æ„Ÿæƒ…
        }
    },
    "misunderstanding": {
        "change": -10,  # ä»-6å¢åŠ åˆ°-10ï¼Œç¡®ä¿è¯¯è§£æ‰£åˆ†æ˜æ˜¾
        "description": "äº§ç”Ÿè¯¯è§£",
        "conditions": {
            "æ²Ÿé€šä¸è‰¯": -5,  # ä»-3å¢åŠ åˆ°-5
            "ç¬¬ä¸€å°è±¡å·®": -6,  # ä»-4å¢åŠ åˆ°-6
        }
    },
    "conflict": {
        "change": -10,  # ä»-8å¢åŠ åˆ°-10ï¼Œç¡®ä¿å†²çªæ‰£åˆ†æ˜æ˜¾
        "description": "ä¸¥é‡å†²çª",
        "conditions": {
            "åŸåˆ™åˆ†æ­§": -5,  # ä»-4å¢åŠ åˆ°-5
            "å…¬å¼€å¯¹ç«‹": -4,  # ä»-3å¢åŠ åˆ°-4
        }
    },
    "disappointment": {
        "change": -8,  # ä»-5å¢åŠ åˆ°-8ï¼Œç¡®ä¿å¤±æœ›æ‰£åˆ†æ˜æ˜¾
        "description": "æ„Ÿåˆ°å¤±æœ›",
        "conditions": {
            "æœŸæœ›è½ç©º": -5,  # ä»-3å¢åŠ åˆ°-5
            "è¢«å¿½è§†": -5,    # ä»-3å¢åŠ åˆ°-5
        }
    },
    "deep_conversation": {
        "change": 3,  # ä»5é™ä½åˆ°3ï¼Œå‡å°‘æ­£é¢åŠ åˆ†
        "description": "æ·±åº¦äº¤æµ",
        "conditions": {
            "é«˜å…³ç³»åŸºç¡€": +1,  # ä»+2é™ä½åˆ°+1
            "ç§å¯†åœºæ‰€": +1,  # åœ¨å®¶æˆ–å®‰é™åœ°æ–¹
        }
    },
    "collaboration": {
        "change": 4,  # ä»6é™ä½åˆ°4ï¼Œå‡å°‘æ­£é¢åŠ åˆ†
        "description": "åˆä½œå…±äº‹",
        "conditions": {
            "æˆåŠŸåˆä½œ": +2,  # ä»+3é™ä½åˆ°+2
            "ç›¸åŒä¸“ä¸š": +1,  # ä»+2é™ä½åˆ°+1
        }
    },
    "help_assistance": {
        "change": 3,  # ä»4é™ä½åˆ°3ï¼Œå‡å°‘æ­£é¢åŠ åˆ†
        "description": "å¸®åŠ©ååŠ©",
        "conditions": {
            "ç´§æ€¥å¸®åŠ©": +2,  # ä»+3é™ä½åˆ°+2
            "ä¸“ä¸šå¸®åŠ©": +1,  # ä»+2é™ä½åˆ°+1
        }
    },
    "reconciliation": {
        "change": 2,  # ä»4é™ä½åˆ°2ï¼Œè¿›ä¸€æ­¥å‡å¼±å’Œè§£æ•ˆæœ
        "description": "å’Œè§£",
        "conditions": {
            "ä¸»åŠ¨é“æ­‰": +1,  # ä»+2é™ä½åˆ°+1
            "ç¬¬ä¸‰æ–¹è°ƒè§£": +1,  # ä¿æŒ+1
        }
    },
    "casual_meeting": {
        "change": 1,
        "description": "å¶ç„¶ç›¸é‡",
        "conditions": {
            "æ„å¤–æƒŠå–œ": +1,
        }
    },
    "group_activity": {
        "change": 1,  # ä»2é™ä½åˆ°1ï¼Œå‡å°‘æ­£é¢åŠ åˆ†
        "description": "ç¾¤ä½“æ´»åŠ¨",
        "conditions": {
            "æ´»åŠ¨é¢†å¯¼": +1,  # ä¿æŒ+1
            "ç§¯æå‚ä¸": +0,  # ä»+1é™ä½åˆ°+0
        }
    },
    "ignore": {
        "change": -3,  # ä»-2å¢åŠ åˆ°-3ï¼Œç¡®ä¿å¿½è§†æ‰£åˆ†æ˜æ˜¾
        "description": "å¿½è§†å†·æ·¡",
        "conditions": {
            "é•¿æœŸå¿½è§†": -4,  # ä»-3å¢åŠ åˆ°-4
            "æ•…æ„å†·è½": -3,  # ä»-2å¢åŠ åˆ°-3
        }
    },
    "public_humiliation": {  # æ–°å¢ï¼šå…¬å¼€ç¾è¾±
        "change": -12,  # ä»-10å¢åŠ åˆ°-12ï¼Œç¡®ä¿ç¾è¾±æ‰£åˆ†æ˜æ˜¾
        "description": "å…¬å¼€ç¾è¾±",
        "conditions": {
            "æ¶æ„ä¸­ä¼¤": -6,  # ä»-5å¢åŠ åˆ°-6
            "ä¼—äººå›´è§‚": -4,  # ä»-3å¢åŠ åˆ°-4
        }
    },
    "betrayal": {  # æ–°å¢ï¼šèƒŒå›
        "change": -15,  # ä»-12å¢åŠ åˆ°-15ï¼Œç¡®ä¿èƒŒå›æ‰£åˆ†æ˜æ˜¾
        "description": "èƒŒå›ä¿¡ä»»",
        "conditions": {
            "ç ´åæ‰¿è¯º": -5,  # ä»-4å¢åŠ åˆ°-5
            "å‡ºå–ç§˜å¯†": -8,  # ä»-6å¢åŠ åˆ°-8
        }
    }
}

# å…³ç³»è¡°å‡é…ç½®
RELATIONSHIP_DECAY = {
    "enabled": True,
    "daily_decay": 0.5,  # æ¯å¤©è‡ªç„¶è¡°å‡
    "min_threshold": 20,  # æœ€ä½ä¸ä¼šè¡°å‡åˆ°20ä»¥ä¸‹
    "max_level": 100,  # æœ€é«˜å…³ç³»å€¼
    "decay_intervals": {
        "é™Œç”Ÿ": 0.1,      # é™Œç”Ÿå…³ç³»è¡°å‡å¾ˆæ…¢
        "è®¤è¯†": 0.3,
        "ç†Ÿäºº": 0.5,
        "å¥½æœ‹å‹": 0.7,    # å¥½æœ‹å‹ä¸è”ç³»ä¼šè¡°å‡è¾ƒå¿«
        "äº²å¯†æœ‹å‹": 0.4,  # äº²å¯†æœ‹å‹æœ‰ä¸€å®šæŠ—è¡°å‡æ€§
    }
}

# ç‰¹æ®Šå…³ç³»ä¿®æ­£
PERSONALITY_MODIFIERS = {
    "å¤–å‘": {"social_bonus": 1.2, "first_meeting": 1.5},
    "å†…å‘": {"social_bonus": 0.8, "deep_talk": 1.3},
    "å‹å–„": {"positive_interactions": 1.3, "conflict_resistance": 1.2},
    "ä¸¥è‚ƒ": {"professional_bonus": 1.4, "casual_penalty": 0.8},
    "å¹½é»˜": {"group_activity": 1.3, "tension_relief": 1.5},
    "è°¨æ…": {"trust_building": 0.7, "long_term": 1.2},
}

# èŒä¸šç›¸æ€§é…ç½®
PROFESSION_COMPATIBILITY = {
    "ç¨‹åºå‘˜": {
        "ç¨‹åºå‘˜": 1.3,     # åŒè¡Œç›¸æ€§å¥½
        "è‰ºæœ¯å®¶": 0.9,     # ç†æ€§vsæ„Ÿæ€§ç¨æœ‰å·®å¼‚
        "è€å¸ˆ": 1.1,       # éƒ½éœ€è¦é€»è¾‘æ€ç»´
        "åŒ»ç”Ÿ": 1.0,
        "å­¦ç”Ÿ": 1.2,       # å–œæ¬¢æ•™å­¦ç”Ÿ
        "å•†äºº": 0.8,       # ä»·å€¼è§‚å¯èƒ½ä¸åŒ
        "å¨å¸ˆ": 1.0,
        "æœºæ¢°å¸ˆ": 1.2,     # éƒ½æ˜¯æŠ€æœ¯å·¥ä½œ
        "é€€ä¼‘äººå‘˜": 0.9,
    },
    "è‰ºæœ¯å®¶": {
        "ç¨‹åºå‘˜": 0.9,
        "è‰ºæœ¯å®¶": 1.4,     # åŒè¡Œæƒºæƒºç›¸æƒœ
        "è€å¸ˆ": 1.2,       # éƒ½å…³æ³¨è¡¨è¾¾å’Œåˆ›é€ 
        "åŒ»ç”Ÿ": 1.0,
        "å­¦ç”Ÿ": 1.3,       # å¯å‘åˆ›é€ åŠ›
        "å•†äºº": 0.7,       # å•†ä¸šåŒ–vsè‰ºæœ¯ç†æƒ³
        "å¨å¸ˆ": 1.3,       # éƒ½æ˜¯åˆ›é€ ç¾çš„å·¥ä½œ
        "æœºæ¢°å¸ˆ": 0.8,
        "é€€ä¼‘äººå‘˜": 1.1,
    },
    # ... å…¶ä»–èŒä¸šç»„åˆ
    
}

# åœ°ç‚¹å¯¹å…³ç³»çš„å½±å“
LOCATION_EFFECTS = {
    "å’–å•¡å…": {"casual_boost": 1.2, "atmosphere": "è½»æ¾"},
    "å›¾ä¹¦é¦†": {"deep_talk": 1.3, "atmosphere": "å®‰é™"},
    "å…¬å›­": {"relax_boost": 1.1, "atmosphere": "è‡ªç„¶"},
    "åŠå…¬å®¤": {"professional": 1.2, "atmosphere": "æ­£å¼"},
    "å®¶": {"intimate": 1.4, "atmosphere": "ç§å¯†"},
    "åŒ»é™¢": {"serious": 1.0, "atmosphere": "ä¸¥è‚ƒ"},
    "é¤å…": {"social": 1.2, "atmosphere": "ç¤¾äº¤"},
    "ä¿®ç†åº—": {"practical": 1.1, "atmosphere": "å®ç”¨"},
}

# æ—¶é—´å¯¹å…³ç³»çš„å½±å“
TIME_EFFECTS = {
    "æ™¨é—´": {"energy": 1.1, "mood": "æ¸…æ–°"},
    "åˆé—´": {"social": 1.2, "mood": "æ´»è·ƒ"},
    "å‚æ™š": {"relaxed": 1.2, "mood": "æ”¾æ¾"},
    "å¤œé—´": {"intimate": 1.3, "mood": "ç§å¯†"},
}

# å…³ç³»é˜ˆå€¼å˜åŒ–æé†’
RELATIONSHIP_CHANGE_MESSAGES = {
    "å‡çº§": {
        "é™Œç”Ÿâ†’è®¤è¯†": "ä»é™Œç”Ÿäººå˜æˆäº†è®¤è¯†çš„æœ‹å‹",
        "è®¤è¯†â†’ç†Ÿäºº": "å…³ç³»æ›´è¿›ä¸€æ­¥ï¼Œæˆä¸ºäº†ç†Ÿäºº",
        "ç†Ÿäººâ†’å¥½æœ‹å‹": "å‹è°ŠåŠ æ·±ï¼Œæˆä¸ºäº†å¥½æœ‹å‹",
        "å¥½æœ‹å‹â†’äº²å¯†æœ‹å‹": "æˆä¸ºäº†æ— è¯ä¸è°ˆçš„äº²å¯†æœ‹å‹",
    },
    "é™çº§": {
        "äº²å¯†æœ‹å‹â†’å¥½æœ‹å‹": "å…³ç³»æœ‰æ‰€ç–è¿œï¼Œä½†ä»æ˜¯å¥½æœ‹å‹",
        "å¥½æœ‹å‹â†’ç†Ÿäºº": "å‹è°Šæ·¡åŒ–ï¼Œå›åˆ°ç†Ÿäººå…³ç³»",
        "ç†Ÿäººâ†’è®¤è¯†": "å…³ç³»å˜æ·¡ï¼Œåªæ˜¯ä¸€èˆ¬è®¤è¯†",
        "è®¤è¯†â†’é™Œç”Ÿ": "å…³ç³»ç–è¿œï¼Œå˜å¾—é™Œç”Ÿ",
    }
}

def get_relationship_level(strength: int) -> str:
    """æ ¹æ®å…³ç³»å¼ºåº¦è·å–å…³ç³»ç­‰çº§"""
    # ç¡®ä¿strengthåœ¨åˆç†èŒƒå›´å†…
    strength = max(-20, min(100, strength))
    
    for level, config in RELATIONSHIP_LEVELS.items():
        if config["min"] <= strength <= config["max"]:
            return level
    
    # å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ï¼Œæ ¹æ®æ•°å€¼è¿”å›åˆé€‚ç­‰çº§
    if strength < 0:
        return "æ•Œå¯¹"
    elif strength <= 20:
        return "å†·æ·¡"
    else:
        return "è®¤è¯†"

def get_level_info(level: str) -> dict:
    """è·å–å…³ç³»ç­‰çº§è¯¦ç»†ä¿¡æ¯"""
    return RELATIONSHIP_LEVELS.get(level, {})

def calculate_interaction_effect(
    interaction_type: str, 
    conditions: dict = None
) -> tuple:
    """
    è®¡ç®—äº’åŠ¨æ•ˆæœ
    è¿”å› (å˜åŒ–å€¼, è¯¦ç»†è¯´æ˜)
    """
    if interaction_type not in INTERACTION_EFFECTS:
        return 1, f"æœªçŸ¥äº’åŠ¨ç±»å‹: {interaction_type}"
    
    base_effect = INTERACTION_EFFECTS[interaction_type]
    base_change = base_effect["change"]
    description = base_effect["description"]
    
    total_change = base_change
    details = [f"åŸºç¡€{description}: {base_change:+d}"]
    
    # åº”ç”¨æ¡ä»¶ä¿®æ­£
    if conditions:
        for condition, active in conditions.items():
            if active and condition in base_effect["conditions"]:
                modifier = base_effect["conditions"][condition]
                total_change += modifier
                details.append(f"{condition}: {modifier:+d}")
    
    return total_change, " | ".join(details)
